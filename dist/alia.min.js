/*! alia 2014-07-03 */
!function(a,b,c,d){function e(a,b){for(var c in b)b.hasOwnProperty(c)&&(a=a.replace(":"+c,b[c]));return a}function f(a){this.defaultPrevented=!1,this.result=d,this.type=a}function g(){for(var a,b=A.length;b;){if(b--,a=A[b].charCodeAt(0),57==a)return A[b]="A",A.join("");if(90!=a)return A[b]=String.fromCharCode(a+1),A.join("");A[b]="0"}return A.unshift("0"),A.join("")}function h(){function b(){var b=a(this),c=b.attr("alia-context"),d=g();h.ids[c]=d,b.attr("id",d)}var c="",d="",e=null;if(1===arguments.length?d=arguments[0]:2===arguments.length?"string"==typeof arguments[1]?(c=arguments[0],d=arguments[1]):"object"==typeof arguments[1]&&(d=arguments[0],e=arguments[1]):3===arguments.length&&(c=arguments[0],d=arguments[1],e=arguments[2]),"string"!=typeof c)throw new Error("Append only accepts string keys");if("string"!=typeof d||0===d.length)throw new Error("Append only accepts non-empty string html arguments");if(e&&("object"!=typeof e||Array.isArray(e)))throw new Error("Append only accepts object parameters");if(!this.ids.hasOwnProperty(c))throw new Error("Unrecognized key");for(var f in e)e.hasOwnProperty(f)&&(d=d.replace(new RegExp(":"+f,"g"),e[f]));var h=new s,i=a(d);return i.filter("[alia-context]").each(b),i.find("[alia-context]").each(b),a("#"+this.ids[c]).append(i),h}function i(){for(var b in this.ids)a("#"+this.ids[b]).empty()}function j(b){if(1===arguments.length)a("#"+this.ids[""]).click(this,b);else if(2===arguments.length){var c=arguments[0],b=arguments[1];a("#"+this.ids[""]).click(c,function(a){b(a.data)})}else if(3===arguments.length){var c=arguments[0],d=arguments[1],b=arguments[2];a("#"+this.ids[""]).click(c,function(c){var e=parseInt(a(this).children("td:has(#"+c.target.id+")").index());e>=0&&d.hasOwnProperty(e)?d[e](c.data):b(c.data)})}return this}function k(b){return a("#"+this.ids[""]).click(this,function(){a("html, body").animate({scrollTop:a('[name="'+b+'"]').offset().top-parseInt(a("body").css("padding-top"))},300)}),this}function l(b){return a("#"+this.id()).keypress(function(a){13===a.which&&(a.preventDefault(),b())}),this}function m(b,c){return a("#"+this.ids[""]).hover(b,c),this}function n(b){return a("#"+this.ids[""]).focusout(b),this}function o(b){return a(window).resize(function(){var c=a("#"+this.ids[""]).width();b(c)}.bind(this)),this}function q(a){Object.defineProperty(this,"id",{value:a,writable:!1,enumerable:!0,configurable:!1})}function r(a){this.ids="string"==typeof a?{"":a}:a}function s(){this.ids={}}function t(a){var b=w.$localStorage,c=b.get("leftCollapsed"),d=b.get("rightCollapsed");null===c&&(c=!1,b.set("leftCollapsed",!1)),null===d&&(c=!1,b.set("rightCollapsed",!1)),this.body=a.append('<div alia-context class="multiview-body sticky-navigation sticky-menu"></div>'),this.nav=this.body.append('<div alia-context class="multiview-navigation"></div>').onHover(function(){this.body.class("add","peek-navigation")}.bind(this),function(){this.body.class("remove","peek-navigation")}.bind(this)),this.menu=this.body.append('<div alia-context class="multiview-menu"></div>').onHover(function(){this.body.class("add","peek-menu")}.bind(this),function(){this.body.class("remove","peek-menu")}.bind(this)),this.body.append('<div alia-context class="multiview-navigation-draggable"></div>').onClick(function(){this.body.class("toggle","sticky-navigation"),this.body.class("toggle","collapse-navigation"),c=!c,b.set("leftCollapsed",c)}.bind(this)).onHover(function(){this.body.class("add","peek-navigation")}.bind(this),function(){this.body.class("remove","peek-navigation")}.bind(this)),this.viewport=this.body.append('<div alia-context class="multiview-viewport"></div>'),this.body.append('<div alia-context class="multiview-menu-draggable"></div>').onClick(function(){this.body.class("toggle","sticky-menu"),this.body.class("toggle","collapse-menu"),d=!d,b.set("rightCollapsed",d)}.bind(this)).onHover(function(){this.body.class("add","peek-menu")}.bind(this),function(){this.body.class("remove","peek-menu")}.bind(this)),c&&this.body.class("add","collapse-navigation"),d&&this.body.class("add","collapse-menu");var e=this;this.nav.push=function(){return e.push.apply(e,arguments),this},this.viewport.push=function(){return e.push.apply(e,arguments),this},this.views={},this.default=null,this.active=null}function u(a){this.context=a.context,this.control=a.control,this.viewport=a.viewport,this.definitions={},this.singletons={},this.root=null,this.active=null}function v(b,c){this.workspace=b,this.id=c.id,this.name=c.name,this.signature=c.signature,this.args=c.args||d,this.control=c.control,this.view=c.view,this.panel=c.panel,this.body=c.body,this.element=a("#"+this.id),this.detached=!1,this.parent=c.parent||null,this.child=null,this.subtasks=[]}var w={},x={},y={};c.applyDefaults=function(a,b,c){for(var d in b)(!a.hasOwnProperty(d)||c&&c.hasOwnProperty(d)&&!c[d].hasOwnProperty(a[d]))&&(a[d]=b[d])},c.defaults=c.applyDefaults,c.replace=e,c.version="0.1.0",c.error=function(a){for(var b=1;b<arguments.length;++b)a=a.replace(/\?/,"'"+arguments[b]+"'");return new Error(a)},f.prototype.isDefaultPrevented=function(){return this.defaultPrevented},f.prototype.preventDefault=function(){this.defaultPrevented=!0};var z={};c.on=function(a,b){var c=z[a];c||(c=z[a]=[]),c.push(b)},c.broadcast=function(a,b){var c=new f(a),d=z[a];if(d){var e=[c];if(2===arguments.length)e=e.concat(b);else if(arguments.length>2)for(var g=1;g<arguments.length;++g)e.push(arguments[g]);for(var g=0;g<d.length&&(c.result=d[g].apply(null,e),!c.isDefaultPrevented());++g);}return c},c.href=function(a){var b=w.$location;return"#"===a.charAt(0)?b.path().substr(1)+a:a};var A=["0","0","0"],B=a("body").find("[alia-viewport]").first();B.attr("id",g());var C=new r(B.attr("id"));c.viewport=C;var D=C,E="view";c.currentContext=function(){return D},c.currentContextType=function(){return E},c.stageMultiviewContext=function(){return C.empty(),E="multiview",D=t.create(C)},c.stageViewContext=function(){return C.empty(),E="view",D=C},c.stageWorkspaceContext=function(){return C.empty(),E="workspace",D=u.create(C)};var F=a("body").find("[alia-alerts]").first();F.attr("id",g()),c.alerts=new r(F.attr("id"));var G=a("body").find("[alia-header]").first();G.attr("id",g()),c.header=new r(G.attr("id")),q.prototype.hide=function(){a("#"+this.id).hide()},q.prototype.onClick=function(b){return a("#"+this.id).click(this,b),this},q.prototype.show=function(){a("#"+this.id).show()},r.prototype.append=h,r.prototype.empty=i,s.prototype.animateOnClick=function(b,c,d){var e=this;a("#"+b.id()).click(function(){a("#"+e.id()).animate(c,d)})},s.prototype.bindCheckboxField=function(b,c){1===arguments.length&&(c=b,b="");var d=a("#"+this.id(b)),c=this.defineProperty("checked",c);if(!c.isSettable())throw new Error("Attempted to bind non-settable observer to checkbox field");var e;c.onResolve(function(a){e!==a&&(e=a,d.prop("checked",a))}),d.on("change",function(){var a=d.prop("checked")||!1;e!==a&&(e=a,p.set(e))})},s.prototype.bindCollapse=function(b,c){var d=this.defineProperty("collapsed",c),e=a("#"+this.id(b));d.onResolve(function(a){a?e.slideUp(200):e.slideDown(200)})},s.prototype.bindDisabled=function(b,c){1===arguments.length&&(c=b,b="");var d=a("#"+this.id(b));return this.defineProperty("disabled",c).onResolve(function(a){a===!0?d.attr("disabled","disabled"):d.removeAttr("disabled")}),this},s.prototype.bindHtml=function(b,c,d){2===arguments.length&&(d=c,c=b,b="");var e=a("#"+this.id(b));return this.defineProperty(c,d).onResolve(function(a){e.html(a)}),this},s.prototype.bindDate=function(b,c){switch(arguments.length){case 1:c=b,b=""}var d,e=a("#"+this.id(b)),f=function(){return new Date(e.val())},g=this.defineProperty("date",c);e.change(function(){var a=f();d!==a&&(d=a,g.set(d))}),g.onResolve(function(a){d!==a&&(d=a,e.datepicker("setDate",d))})},s.prototype.bindText=function(b,c,d,e){switch(arguments.length){case 1:e="text",d=b,c="text",b="";case 2:e=c,d=b,c="text",b="";break;case 3:e=d,d=c,c=b,b=""}var f,g=a("#"+this.id(b)),h=this.defaultParser(e),i=function(){var a;try{a=h(g.val())}catch(b){a=null}return a},j=this.defineProperty(c,d);g.on("input",function(){var a=i();f!==a&&(f=a,j.set(f))}),j.onResolve(function(a){f!==a&&(f=a,g.val(f))}),j.onUnresolve(function(){g.val("")})},s.prototype.bindSelectValue=function(b,c){1===arguments.length&&(c=b,b="");var d,e=a("#"+this.id(b)),f=this.defineProperty("selected",c);e.on("change",function(){var a=e.val();d!==a&&(d=a,f.set(d))}),f.onResolve(function(a){d!==a&&(d=a,e.val(d))})},s.prototype.bindVisible=function(b,c){1===arguments.length&&(c=b,b="");var d=a("#"+this.id(b));return this.defineProperty("visible",c).onResolve(function(a){a===!0?d.show():d.hide()}),this},s.prototype.defaultParser=function(a){switch(a){case"number":return function(a){return parseInt(a)};default:return function(a){return a||""}}},s.prototype.append=h,s.prototype.empty=i,s.prototype.attr=function(a,b){return this.kattr("",a,b)},s.prototype.class=function(a,b){return this.kclass("",a,b)},s.prototype.doClick=function(){a("#"+this.ids[""]).click()},s.prototype.css=function(a,b){return this.kcss("",a,b)},s.prototype.defineProperty=function(a,b){var d;return d=c.isAccessor(b)?b:b instanceof Promise?c.promise(b):c.state(b),Object.defineProperty(this,a,{value:d,writable:!1,enumerable:!0,configurable:!1}),d},s.prototype.defineStatic=function(a,b){Object.defineProperty(this,a,{value:b,writable:!1,enumerable:!0,configurable:!1})},s.prototype.defineEvent=function(a){var b=this,c={},d="on"+a.charAt(0).toUpperCase()+a.slice(1),e="emit"+a.charAt(0).toUpperCase()+a.slice(1);this[d]=function(d){var e=c[a];return e||(e=c[a]=[]),e.push(d),b},this[e]=function(b){var d=new f(a),e=c[a];if(e){var g=[d];if(1===arguments.length)g=g.concat(b);else if(arguments.length>1)for(var h=0;h<arguments.length;++h)g.push(arguments[h]);for(var h=0;h<e.length&&(d.result=e[h].apply(null,g),!d.isDefaultPrevented());++h);}return d}},s.prototype.html=function(a){return this.khtml("",a)},s.prototype.id=function(a){return"string"!=typeof a?this.ids[""]:this.ids[a]},s.prototype.kattr=function(b,c,d){return d?void a("#"+this.ids[b]).attr(c,d):a("#"+this.ids[b]).attr(c)},s.prototype.kclass=function(b,c,d){return"add"===c?a("#"+this.ids[b]).addClass(d):"remove"===c?a("#"+this.ids[b]).removeClass(d):"toggle"===c&&a("#"+this.ids[b]).toggleClass(d),this},s.prototype.kcss=function(b,c,d){return d?(a("#"+this.ids[b]).css(c,d),this):a("#"+this.ids[b]).css(c)},s.prototype.khtml=function(b,c){return c?void a("#"+this.id(b)).html(c):a("#"+this.id(b)).html(c)},s.prototype.onClick=j,s.prototype.onClickScrollTo=k,s.prototype.onEnterKey=l,s.prototype.onFocusOut=n,s.prototype.onHover=m,s.prototype.onResize=o,s.prototype.removeAttr=function(b){a("#"+this.id()).removeAttr(b)},s.prototype.slideDownOnClick=function(b,c){var d=this;a("#"+b.id()).click(function(){c?a("#"+d.id()).slideDown(c):a("#"+d.id()).slideDown()})},s.prototype.slideUpOnClick=function(b,c){var d=this;a("#"+b.id()).click(function(){c?a("#"+d.id()).slideUp(c):a("#"+d.id()).slideUp()})},s.prototype.width=function(){return a("#"+this.ids[""]).width()},c.multiviewSignature=function(a,b){var c=[];for(var d in b)b.hasOwnProperty(d)&&"view"!==d&&c.push(d+"="+b[d]);return["view="+a].concat(c.sort()).join("&")},t.prototype.begin=function(a,b){var c=w.$location;return this.active||c.search().hasOwnProperty("view")||this.push(a,b),this},t.create=function(a){var b=new t(a);return{begin:function(){return b.begin.apply(b,arguments),this},currentSignature:function(){return b.active?b.active.signature:""},include:function(){return b.include.apply(b,arguments),this},navigation:function(){return b.navigation.apply(b,arguments),this},push:function(){return b.push.apply(b,arguments),this},signature:function(){return b.signature.apply(b,arguments),this},view:function(){return b.view.apply(b,arguments),this}}},t.prototype.include=function(a){if("string"!=typeof a.name)throw new Error("Missing or invalid view name during multiview definition");return this.views[a.name]={name:a.name,included:y[a.path]},this},t.prototype.push=function(a,b){var d=this.views[a];if(!d)throw new Error("Unknown view: "+a);var e=this.signature(a,b);if(!this.active||this.active.signature!==e){var f=this.viewport;"function"==typeof d.viewport?(f.empty(),d.viewport(this.viewport,b)):"object"==typeof d.included&&c.resolve(d.included.opts.dependencies,[this.viewport],{$query:b}).onResolve(function(a){f.empty(),d.included.ctor.apply(null,a)});var g=(null===this.active,{signature:e});this.active=g;var h=w.$location;return h.search(this.active.signature),g}},t.prototype.navigation=function(a){return a(this.nav),this},t.prototype.signature=function(a,b){var c=[];for(var d in b)b.hasOwnProperty(d)&&"view"!==d&&c.push(d+"="+b[d]);return["view="+a].concat(c.sort()).join("&")},t.prototype.view=function(a){if("string"!=typeof a.name)throw new Error("Missing or invalid view name during multiview definition");if("function"!=typeof a.viewport)throw new Error("Missing or invalid viewport function during multiview definition");return this.views[a.name]={name:a.name,viewport:a.viewport},this},u.prototype.activate=function(b){if(console.log(b),!b.isActive()){b.child&&(b.child.detach(),b.child=null);var c=b.parent;c&&(c===this.root&&this.keepRootOpen||c.collapse(),c.child===b?b.expand():null!==c.child&&c.child.detach(),c.child=b),this.viewport.empty(),b.view(this.viewport,b.args),b.detached&&(a("#"+this.control.id("stack")).append(b.element),b.detached=!1,a("#"+b.panel.id()).show(),a("#"+b.body.id()).show(),a("#"+b.id).show())}},u.prototype.begin=function(a,b){return this.keepRootOpen=b===!0,this.viewport.empty(),this.active||(console.log("no active"),this.push(null,a)),this},u.create=function(b){a("#"+C.ids[""]).addClass("workspace");var b=C.append(['<div alia-context class="container-fluid">','  <div alia-context="body" class="row"></div>',"</div>"].join("")),c=new u({context:b,control:b.append("body",['<div alia-context class="col-lg-3">','  <div alia-context="stack" class="panel-group"></div>',"</div>"].join("")),viewport:b.append("body",['<div alia-context class="col-lg-9"></div>'].join("")),keepRootOpen:!1});return{begin:function(){return c.begin.apply(c,arguments),this},currentSignature:function(){return c.active.signature},define:function(){return c.define.apply(c,arguments),this},include:function(){return c.include.apply(c,arguments),this},push:function(a,b){console.log("external push"),c.root?c.push(c.root,a,b):(console.log(a),c.preload={name:a,args:b})},signature:function(a,b){return c.signature(a,b)}}},u.prototype.define=function(a){if("string"!=typeof a.name)throw new Error("Missing or invalid task name in definition");return this.definitions[a.name]={name:a.name,title:a.title,singleton:a.singleton===!0,control:a.control,view:a.view},this},u.prototype.include=function(){return this},u.prototype.push=function(b,d,e){var f=this.definitions[d];if(!f)throw new Error("Unknown task: "+d);if(!b&&!f.singleton)throw new Error("Attempted to add instance class with no parent");var g=this.signature(d,e),h=this.singletons[g];if(h)this.activate(h);else{var i=this.control.append("stack",['<div alia-context class="panel panel-default">','  <div alia-context="header" style="cursor: pointer;" class="panel-heading">','    <h4 alia-context="title" class="panel-title"></h4>',"  </div>","</div>"].join("")),j=i.append('<div alia-context class="panel-body"></div>'),k=c.state(f.title);j.defineProperty("title",k),j.title.assign(i,"khtml","title"),h=new v(this,{id:i.id(),parent:b,name:d,signature:g,args:e,panel:i,body:j,control:f.control,view:f.view}),f.singleton?this.singletons[g]=h:b.subtasks.push(h),j.push=h.push.bind(h),this.viewport.push=h.push.bind(h);var l=a("#"+i.id("header"));l.click(function(){this.activate(h)}.bind(this)),this.render(h),this.activate(h)}if(this.active=h,b){var m=w.$location;m.search(g)}return h},u.prototype.render=function(a){a.control(a.body,a.args),this.viewport.empty(),a.view(this.viewport,a.args)},u.prototype.signature=function(a,b){var c=[];for(var d in b)b.hasOwnProperty(d)&&"task"!==d&&c.push(d+"="+b[d]);return["task="+a].concat(c.sort()).join("&")},v.prototype.collapse=function(){a("#"+this.body.id()).slideUp(200)},v.prototype.detach=function(){function b(){0===--d&&(console.log("detach"),c.element.detach(),c.detached=!0)}for(var c=this,d=0,e=this;null!==e;)d+=2,a("#"+e.panel.id()).slideUp(200,b),a("#"+e.id).fadeOut(200,b),e=e.child},v.prototype.expand=function(){a("#"+this.body.id()).slideDown(200)},v.prototype.hasSubtask=function(a){for(var b=0;b<this.subtasks.length;++b)if(this.subtasks===a)return!0;return!1},v.prototype.isActive=function(){return this.workspace.active===this},v.prototype.isVisible=function(){for(var a=this.workspace.root;a!==this&&null!==a.child;)a=a.child;return a===this},v.prototype.push=function(a,b){return this.workspace.push(this,a,b)},c.defineControl=function(a,b){var d="do"+a.name.charAt(0).toUpperCase()+a.name.slice(1);c[d]=function(a,c){var d=b.call(a,c);return d}},c.defineHeader=function(a,b){c.resolve(a.dependencies).then(function(a){c.header.empty();var d=b.apply(null,a),e=d.call(null,c.header);return e})},c.defineLayout=function(a,b){var d="layout"+a.name.charAt(0).toUpperCase()+a.name.slice(1);c[d]=function(a,c,d){var e=b.call(a,c);return function(){return d(e),e}()}},c.defineModule=function(){},c.defineMultiview=function(a,b){c.defineView({path:a.path,dependencies:a.dependencies,multiview:!0},b)},c.defineProvider=function(a,b){if("string"!=typeof a.name||"$"!==a.name.substr(0,1))throw new Error("Missing or invalid provider name");var c=[],d=a.dependencies;if(d)for(var e=0;e<d.length;++e){if(!w.hasOwnProperty(d[e]))throw new Error("Unable to resolve provider dependency");c.push(w[d[e]])}w[a.name]=b.apply(null,c)},c.resolve=function(a,b,d){b=b||[];for(var e=0;e<a.length;++e)d&&d.hasOwnProperty(a[e])?b.push(d[a[e]]):w.hasOwnProperty(a[e])?b.push(w[a[e]]):x.hasOwnProperty(a[e])&&b.push(x[a[e]].accessor);return c.all(b)},c.defineService=function(a,b){console.log("--- DEFINE SERVICE:",a.name);x[a.name]={dependencies:a.dependencies,constructor:b,accessor:c.resolve(a.dependencies).then(function(a){return b.apply(null,a)})}},c.defineView=function(a,b){var c=w.$route;if(!c)throw new Error("Missing route provider");y[a.path]={opts:a,ctor:b},c.when(a,b),a.default===!0&&c.otherwise(a,b)},c.defineWidget=function(){},c.defineWorkspace=function(a,b){c.defineView({path:a.path,dependencies:a.dependencies,workspace:!0},b)},c.int=function(a){return parseInt(a,10)},c.lowercase=function(a){return c.isString(a)?a.toLowerCase():a},c.noop=function(){}}($,Bacon,window.alia=window.alia||{}),function(a,b,c){function d(a,b,c,d,e){for(var f=0;e>f;++f)c[f+d]=a[f+b]}function e(a){this._capacity=a,this._length=0,this._front=0,this._makeCapacity()}function f(a,b,c){try{return a.call(b,c)}catch(d){return u.e=d,u}}function g(){this._isTickUsed=!1,this._schedule=s,this._length=0,this._lateBuffer=new e(16),this._functionBuffer=new e(65536);var a=this;this.consumeFunctionBuffer=function(){a._consumeFunctionBuffer()}}function h(){}function i(a,b,c){this._resolved=a===!0,this._value=b,this._failed=!1,this._errors=void 0,this._resolveHandlers=void 0,this._unresolveHandlers=void 0,this._errorHandlers=void 0,this._broadcastPending=!1,this._broadcastGroup=0,this._broadcastHandlers=void 0,this._finalized=c===!0}function j(a,b){i.call(this,a,b,!0)}function k(a,b){i.call(this,a,b)}function l(a,b){i.call(this),this._accessor=a,this._property=b,this._path=b.split(".");var c=this;a.observe(function(a){for(var b=1;b<c._path.length;++b){if(!a||!a.hasOwnProperty(c._path[b]))return c._unresolve();a=a[c._path[b]]}c._resolve(a)},function(){c._unresolve()},function(a){c._throw(a)})}function m(a){i.call(this),this._accessor=a,this._items=void 0,this._itemsResolved=void 0;var c=this;a.observe(function(a){if(c._items=[],c._itemsResolved=[],0===a.length)c._resolve([]);else for(var d=0;d<a.length;++d){c._items.push(a[d]),c._itemsResolved.push(!1);var e=a[d];e instanceof i||(c._items[d]=e=b.constant(e)),e.observe(function(a){return function(){if(c._itemsResolved[a]=!0,_.every(c._itemsResolved)){for(var b=[],d=0;d<c._items.length;++d)b.push(c._items[d]._value);c._resolve(b)}}}(d),function(a){return function(){c._itemsResolved[a]=!1,c._unresolve()}}(d),function(a){c._throw(a)})}},function(){c._items=void 0,c._itemsResolved=void 0,c._unresolve()},function(a){c._throw(a)})}function n(a){i.call(this),this._object={};var b=0,c=this;for(var d in a)a[d]instanceof i?(b++,a[d].observe(function(a){return function(b){c._object[a]=b,_.every(c._object,h.not)&&c._resolve(_.clone(c._object))}}(d),function(a){return function(){c._object[a]=new h,c._unresolve()}}(d),function(a){c._throw(a)})):c._object[d]=a[d];0===b&&c._resolve(this._object,!0)}function o(){i.call(this),this._fcn=arguments[arguments.length-1],this._accessors=[],this._accessorsResolved=[];for(var a=this,d=0;d<arguments.length-1;++d){a._accessors.push(arguments[d]),a._accessorsResolved.push(!1);var e=arguments[d];e instanceof i||(a._accessors[d]=e=b.constant(e)),e.observe(function(b){return function(){if(a._accessorsResolved[b]=!0,_.every(a._accessorsResolved)){for(var d=[],e=0;e<a._accessors.length;++e)d.push(a._accessors[e]._value);var f=a._fcn.apply(c,d);f instanceof i?f.observe(function(b){a._resolve(b)},function(){a._unresolve()},function(b){a._throw(b)}):a._resolve(f)}}}(d),function(b){return function(){a._accessorsResolved[b]=!1,a._unresolve()}}(d),function(b){a._throw(b)})}}function p(a,d){i.call(this),this._fcn=d,this._args=b.all(a);var e=this;this._args.observe(function(a){var b=e._fcn.apply(c,a);b instanceof i?b.observe(function(a){e._resolve(a)},function(){e._unresolve()},function(a){e._throw(a)}):e._resolve(b)},function(){e._unresolve()},function(a){e._throw(a)})}function q(a){i.call(this);var b=this;a.then(function(a){b._resolve(a,!0)},function(a){b._throw(a)})}function r(a,b){i.call(this),this._accessor=a,this._delay=b,this._timeout=null;var c=this;a.observe(function(a){c._timeout&&clearTimeout(c._timeout),c._timeout=setTimeout(function(){c._resolve(a),c._timeout=null},c._delay)},function(){c._unresolve()},function(a){c._throw(a)})}var s,t;if("object"==typeof process&&"string"==typeof process.version)s=function(a){process.nextTick(a)};else if("undefined"!=typeof MutationObserver&&(t=MutationObserver)||"undefined"!=typeof WebKitMutationObserver&&(t=WebKitMutationObserver))s=function(){var a=document.createElement("div"),b=void 0,c=new t(function(){var a=b;b=void 0,a()});return c.observe(a,{attributes:!0}),function(c){b=c,a.setAttribute("class","foo")}}();else{if("undefined"==typeof setTimeout)throw new Error("no async scheduler available");s=function(a){setTimeout(a,0)}}e.prototype._willBeOverCapacity=function(a){return this._capacity<a},e.prototype._pushOne=function(a){var b=this.length();this._checkCapacity(b+1);var c=this._front+b&this._capacity-1;this[c]=a,this._length=b+1},e.prototype.push=function(a,b,c){var d=this.length()+3;if(this._willBeOverCapacity(d))return this._pushOne(a),this._pushOne(b),void this._pushOne(c);var e=this._front+d-3;this._checkCapacity(d);var f=this._capacity-1;this[e+0&f]=a,this[e+1&f]=b,this[e+2&f]=c,this._length=d},e.prototype.shift=function(){var a=this._front,b=this[a];return this[a]=void 0,this._front=a+1&this._capacity-1,this._length--,b},e.prototype.length=function(){return this._length},e.prototype._makeCapacity=function(){for(var a=this._capacity,b=0;a>b;++b)this[b]=void 0},e.prototype._checkCapacity=function(a){this._capacity<a&&this._resizeTo(this._capacity<<3)},e.prototype._resizeTo=function(a){var b=this._front,c=this._capacity,e=new Array(c),f=this.length();if(d(this,0,e,0,c),this._capacity=a,this._makeCapacity(),this._front=0,c>=b+f)d(e,b,this,0,f);else{var g=f-(b+f&c-1);d(e,b,this,0,g),d(e,0,this,g,f-g)}};var u={e:{}},v="undefined"!=typeof process?process:void 0;g.prototype.haveItemsQueued=function(){return this._length>0},g.prototype.invokeLater=function(a,b,c){void 0===v||null==v.domain||a.domain||(a=v.domain.bind(a)),this._lateBuffer.push(a,b,c),this._queueTick()},g.prototype.invoke=function(a,b,c){void 0===v||null==v.domain||a.domain||(a=v.domain.bind(a));var d=this._functionBuffer;d.push(a,b,c),this._length=d.length(),this._queueTick()},g.prototype._consumeFunctionBuffer=function(){for(var a=this._functionBuffer;a.length()>0;){var b=a.shift(),c=a.shift(),d=a.shift();b.call(c,d)}this._reset(),this._consumeLateBuffer()},g.prototype._consumeLateBuffer=function(){for(var a=this._lateBuffer;a.length()>0;){var b=a.shift(),c=a.shift(),d=a.shift(),e=f(b,c,d);if(e===u){if(this._queueTick(),null==b.domain)throw e.e;b.domain.emit("error",e.e)}}},g.prototype._queueTick=function(){this._isTickUsed||(this._schedule(this.consumeFunctionBuffer),this._isTickUsed=!0)},g.prototype._reset=function(){this._isTickUsed=!1,this._length=0};var w=new g;h.is=function(a){return a instanceof h},h.not=function(a){return!(a instanceof h)},i.prototype._broadcast=function(){var a;if(16&this._broadcastGroup?a=this._value:32&this._broadcastGroup&&(a=this._errors),1&this._broadcastGroup&&this._resolveHandlers)for(var b=0;b<this._resolveHandlers.length;++b)this._resolveHandlers[b].call(void 0,a);if(2&this._broadcastGroup&&this._unresolveHandlers)for(var b=0;b<this._unresolveHandlers.length;++b)this._unresolveHandlers[b].call(void 0,a);if(4&this._broadcastGroup&&this._errorHandlers)for(var b=0;b<this._errorHandlers.length;++b)this._errorHandlers[b].call(void 0,a);if(8&this._broadcastGroup)for(var b=0;b<this._broadcastHandlers.length;++b)this._broadcastHandlers[b].call(void 0,a);this._finalized&&(this._resolveHandlers=void 0,this._unresolveHandlers=void 0,this._errorHandlers=void 0),this._broadcastPending=!1,this._broadcastGroup=0,this._broadcastHandlers=void 0},i.prototype._finalize=function(){this._finalized=!0,this._broadcastPending||(this._resolveHandlers=void 0,this._unresolveHandlers=void 0,this._errorHandlers=void 0,this._broadcastGroup=0,this._broadcastHandlers=void 0)},i.prototype._resolve=function(a,b){if("function"!=typeof b){if(this._resolved&&this._value===a)return;this._resolved=!0,this._value=a,this._failed=!1,this._errors=void 0,this._broadcastGroup=17,this._broadcastHandlers=void 0}else if(0===this._broadcastGroup)this._broadcastGroup=24,this._broadcastHandlers=[b];else if(24===this._broadcastGroup)this._broadcastHandlers.push(b);else if(!(1&this._broadcastGroup))throw new Error("Unable to prime resolve to group "+this._broadcastGroup);this._broadcastPending||(this._broadcastPending=!0,w.invoke(this._broadcast,this))},i.prototype._throw=function(a,b){var c=this._resolved;if(b){if(c)throw new Error("Unable to initialize throw with handler");if(0===this._broadcastGroup)this._broadcastGroup=40,this._broadcastHandlers=[b];else if(40===this._broadcastGroup)this._broadcastHandlers.push(b);else if(!(4&this._broadcastGroup))throw new Error("Unable to prime throw to group "+this._broadcastGroup)}else this._resolved=!1,this._value=void 0,this._failed=!0,void 0===this._errors&&(this._errors=[]),this._errors.push(a),this._broadcastGroup=c?38:36,this._broadcastHandlers=void 0;this._broadcastPending||(this._broadcastPending=!0,w.invoke(this._broadcast,this))},i.prototype._unresolve=function(){this._resolved&&(this._resolved=!1,this._value=void 0,this._failed=!1,this._errors=void 0,this._broadcastGroup=2,this._broadcastHandlers=void 0,this._broadcastPending||(this._broadcastPending=!0,w.invoke(this._broadcast,this)))},i.prototype.get=function(){return this._resolved?_.clone(this._value):void 0},i.prototype.isGettable=function(){return!0},i.prototype.isSettable=function(){return"function"==typeof this.set},i.prototype.observe=function(a,b,c){return"function"==typeof a&&(this._resolveHandlers||(this._resolveHandlers=[]),this._resolveHandlers.push(a),this._resolved&&this._resolve(this._value,a)),"function"==typeof b&&(this._unresolveHandlers||(this._unresolveHandlers=[]),this._unresolveHandlers.push(b)),"function"==typeof c&&(this._errorHandlers||(this._errorHandlers=[]),this._errorHandlers.push(c),this._failed&&this._throw(this._errors,c)),this},i.prototype.onResolve=function(a){return this.observe(a,null,null)},i.prototype.onUnresolve=function(a){return this.observe(null,a,null)},i.prototype.onError=function(a){return this.observe(null,null,a)},i.prototype.isObject=function(){var a=new k;return this.observe(function(b){a.set("object"==typeof b)},function(){a.set(!1)},function(b){a._throw(b)}),a},i.prototype.isResolved=function(){var a=new k;return this.observe(function(){a.set(!0)},function(){a.set(!1)},function(b){a._throw(b)}),a},i.prototype.isUndefined=function(){var a=new k;return this.observe(function(b){a.set(void 0===b)},function(){a.set(!0)},function(b){a._throw(b)}),a},i.prototype.at=function(a){return new l(this,"."+a)},i.prototype.delay=function(a){return new r(this,a)},i.prototype.not=function(){var a=new k;return this.observe(function(b){a.set(!b)},function(){a._unresolve()},function(b){a._throw(b)}),a},i.prototype.property=function(a){return new l(this,a)},i.prototype.startWith=function(a){return this._resolved||this._resolve(a),this},i.prototype.then=function(a){return new p([this],a)},j.prototype=_.create(i.prototype),k.prototype=_.create(i.prototype),k.prototype.set=function(a){this._resolve(a)},l.prototype=_.create(i.prototype),l.prototype.set=function(a){for(var b=this._accessor.get()||{},c=b,d=this._path.length-1,e=1;d>e;++e)c.hasOwnProperty(this._path[e])||(c[this._path[e]]={}),c=c[this._path[e]]||{};c[this._path[d]]=a,this._accessor.set(b)},m.prototype=_.create(i.prototype),n.prototype=_.create(i.prototype),o.prototype=_.create(i.prototype),p.prototype=_.create(i.prototype),q.prototype=_.create(i.prototype),r.prototype=_.create(i.prototype),b.isAccessor=function(a){return a instanceof i},b.all=function(a){return b.isAccessor(a)||(a=b.constant(a)),new m(a)},b.cast=function(a){return a instanceof i?a:new k(!0,a)},b.constant=function(a){return 0===arguments.length?new j:new j(!0,a)},b.deferred=function(a){return new q(new Promise(a))},b.future=function(a){for(var b=[],c=1;c<arguments.length;++c)b.push(arguments[c]);return new p(a,b)},b.join=function(){var a=Object.create(o.prototype);return o.apply(a,arguments),a},b.state=function(a){if(0===arguments.length)return new k;if(a instanceof i){var b=new k;return a.observe(function(a){b.set(a)},function(){b._unresolve()},function(a){b._throw(a)}),b}return new k(!0,a)},b.promise=function(a){return new q(a)},b.props=function(a){return new n(a||{})},b.getString=function(b){return b instanceof a.Property?b.get():"string"==typeof b?b:c}}(Bacon,window.alia=window.alia||{}),function(a){function b(a){for(var b=a.split("/"),c=b.length;c--;)b[c]=d(b[c]);return b.join("/")}function c(a,b){return encodeURIComponent(a).replace(/%40/gi,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,b?"%20":"+")}function d(a){return c(a,!0).replace(/%26/gi,"&").replace(/%3D/gi,"=").replace(/%2B/gi,"+")}function e(b){var c=a.isString(b)?a.url.resolve(b):b;return c.protocol===k.protocol&&c.host===k.host}function f(b){for(var c={},d=(b||"").split("&"),e=0;e<d.length;++e){var f=d[e];if(f){var g=f.split("="),h=i(g[0]);if(a.isDefined(h)){var j=a.isDefined(g[1])?i(g[1]):!0;c[h]?a.isArray(c[h])?c[h].push(j):c[h]=[c[h],j]:c[h]=j}}}return c}function g(b){var c=b;return a.msie&&(j.setAttribute("href",c),c=j.href),j.setAttribute("href",c),{href:j.href,protocol:j.protocol?j.protocol.replace(/:$/,""):"",host:j.host,search:j.search?j.search.replace(/^\?/,""):"",hash:j.hash?j.hash.replace(/^#/,""):"",hostname:j.hostname,port:j.port,pathname:"/"===j.pathname.charAt(0)?j.pathname:"/"+j.pathname}}function h(b){var d=[];for(var e in b){var f=b[e];if(a.isArray(f))for(var g=0;g<f.length;++g){var h=f[g];d.push(c(e,!0)+(h===!0?"":"="+c(h,!0)))}else d.push(c(e,!0)+(f===!0?"":"="+c(f,!0)))}return d.length?d.join("&"):""}function i(a){try{return decodeURIComponent(a)}catch(b){}}var j=document.createElement("a"),k=g(window.location.href,!0);
a.url={encodePath:b,encodeUriSegment:d,encodeUriQuery:c,isSameOrigin:e,parseQuery:f,resolve:g,toQueryString:h,tryDecodeURIComponent:i}}(window.alia=window.alia||{}),function(a,b){b.isArray=function(a){return"[object Array]"===toString.call(a)},b.isArrayLike=function(a){if(null==a||isWindow(a))return!1;var c=a.length;return 1===a.nodeType&&c?!0:b.isString(a)||b.isArray(a)||0===c||"number"==typeof c&&c>0&&c-1 in a},b.isDefined=function(a){return"undefined"!=typeof a},b.isNull=function(a){return null===a},b.isNotNull=function(a){return null!==a},b.isObject=function(a){return null!=a&&"object"==typeof a},b.isProperty=function(b){return b instanceof a.Property},b.isString=function(a){return"string"==typeof a},b.isEmptyString=function(a){return"string"!=typeof a||0===a.length},b.isNotEmptyString=function(a){return"string"==typeof a&&a.length>0},b.isUndefined=function(a){return"undefined"==typeof a},b.isNotUndefined=function(a){return"undefined"!=typeof a},b.isWindow=function(a){return a&&a.document&&a.location&&a.alert&&a.setInterval}}(Bacon,window.alia=window.alia||{}),alia.defineControl({name:"alert"},function(){var a={success:"alert-success",info:"alert-info",warning:"alert-warning",danger:"alert-danger"};return function(b){var c=["alia-alert"];"string"==typeof b.type&&a.hasOwnProperty(b.type)&&c.push(a[b.type]);var d=alia.alerts.append(['<div class=":class" alia-context>','  <span alia-context="content"></span>','  <button alia-context="close" type="button" class="close">&times;</button>',"</div>"].join(""),{"class":c.join(" ")});return"number"==typeof b.autohide&&setTimeout(function(){$("#"+d.id()).fadeOut(500,function(){$(this).remove()})}.bind(this),b.autohide),alia.isAccessor(b.text)?b.text.onResolve(function(a){d.khtml("content",a)}):d.khtml("content",b.text),$("#"+d.id("close")).click(function(){$("#"+d.id()).remove()}),d}}()),alia.defineControl({name:"button"},function(){var a={"default":"btn-default",primary:"btn-primary",success:"btn-success",info:"btn-info",warning:"btn-warning",danger:"btn-danger",link:"btn-link"},b={large:"btn-lg",small:"btn-sm",xsmall:"btn-xs"},c={none:null,"expand-right":"expand-right"};return function(d){alia.applyDefaults(d,{disabled:!1,loadingStyle:"none",progress:null,visible:!0},{loadingStyle:c});var e=["btn"];"boolean"==typeof d.close&&d.close?e[0]="close":(e.push("string"==typeof d.style&&a.hasOwnProperty(d.style)?a[d.style]:a["default"]),"string"==typeof d.size&&b.hasOwnProperty(d.size)&&e.push(b[d.size]));var f;if(alia.isAccessor(d.loading)){var g='<button alia-context type="button" class=":class ladda-button" data-style=":loadingStyle">  <span alia-context="label" class="ladda-label"></span></button>';f=this.append(g,{"class":e.join(" "),loadingStyle:c[d.loadingStyle]});var h=$("#"+f.id()),i=($("#"+f.id("label")),Ladda.create(h[0]));f.bindHtml("label","text",d.text),f.bindDisabled(d.disabled),f.defineProperty("loading",d.loading).onResolve(function(a){a!==i.isLoading()&&i.toggle()})}else{var g='<button alia-context type="button" class=":class"></button>';f=this.append(g,{"class":e.join(" ")});var h=$("#"+f.id());f.bindHtml("text",d.text),f.bindDisabled(d.disabled)}return f.bindVisible(d.visible),f}}()),alia.defineLayout({name:"buttonAddon"},function(){return function(){var a=this.append('<span alia-context class="input-group-btn"></span>');return a}}()),alia.defineLayout({name:"buttonGroup"},function(){var a={large:"btn-group-lg",small:"btn-group-sm",xsmall:"btn-group-xs"};return function(b){var c=["btn-group"];return 1==b.vertical&&(c[0]+="-vertical"),"string"==typeof b.size&&a.hasOwnProperty(b.size)&&c.push(a[b.size]),"boolean"==typeof b.justified&&b.justified&&c.push("btn-group-justified"),this.append('<div alia-context class=":class"></div>',{"class":c.join(" ")})}}()),alia.defineControl({name:"buttonRadioGroup"},function(){return function(a){alia.applyDefaults(a,{currentIndex:0});var b=[],c=-1,d=function(a){return function(){f.set(a)}},e=alia.layoutButtonGroup(this,{},function(c){for(var e=0;e<a.options.length;++e){var f=alia.doButton(c,{text:a.options[e]}).onClick(d(e));b.push({text:a.options[e],btn:f,j:$("#"+f.id())})}}),f=e.defineProperty("currentIndex",a.currentIndex);return f.onResolve(function(a){if(c!==a){if(null!==c&&c>-1){var d=b[c];d.j.removeClass("btn-info"),d.j.addClass("btn-default")}if(null!==a&&a>-1){var e=b[a];e.j.removeClass("btn-default"),e.j.addClass("btn-info")}c=a}}),e}}()),alia.defineLayout({name:"carousel"},function(){return function(a){var b=['<div alia-context class="carousel slide" data-ride="carousel">','  <ol alia-context="indicators" class="carousel-indicators"></ol>','  <div alia-context="items" class="carousel-inner"></div>',"</div>"],c=this.append(b.join(""));"number"==typeof a.auto&&c.attr("data-interval",a.auto);{var d=['<a class="left carousel-control" data-target=":target" data-slide="prev">','  <span class="glyphicon glyphicon-chevron-left"></span>',"</a>",'<a class="right carousel-control" data-target=":target" data-slide="next">','  <span class="glyphicon glyphicon-chevron-right"></span>',"</a>"];c.append(d.join(""),{target:"#"+c.ids[""]})}return c}}()),alia.defineLayout({name:"carouselItem"},function(){return function(a){var b=["item"];"boolean"==typeof a.active&&a.active===!0&&b.push("active");var c=this.append("items",'<div alia-context class=":class"></div>',{"class":b.join(" ")}),d=$("#"+this.id("indicators")+" li").length,e=[];return"boolean"==typeof a.active&&a.active===!0&&e.push("active"),this.append("indicators",'<li data-target=":target" data-slide-to=":no" class=":class"></li>',{no:d,target:"#"+this.id(),"class":e.join(" ")}),c}}()),alia.defineControl({name:"donutChart"},function(){return function(a){function b(a){var b=d3.interpolate(this._current,a);return this._current=b(0),function(a){return h(b(a))}}alia.defaults(a,{visible:!0});var c=960,d=500,e=Math.min(c,d)/2,f=d3.scale.category20(),g=d3.layout.pie().value(function(a){return a}).sort(null),h=d3.svg.arc().innerRadius(e-100).outerRadius(e-20),i=this.append("<div alia-context></div>"),j=$("#"+i.id()),k=d3.select(j[0]).append("svg").attr("width",c).attr("height",d).append("g").attr("transform","translate("+c/2+","+d/2+")"),l=null;return a.data.onResolve(function(a){if(null===l){for(var c=[],d=0;d<a.length;++d)c.push(d);l=k.datum(c).selectAll("path").data(g).enter().append("path").attr("fill",function(a,b){return f(b)}).attr("d",h).each(function(a){this._current=a})}g.value(function(b){return a[b]}),l=l.data(g),l.attr("d",h),l.transition().duration(750).attrTween("d",b)}),i}}()),alia.defineLayout({name:"div"},function(){var a={right:"pull-right",left:"pull-left"};return function(b){alia.applyDefaults(b,{visible:!0});var c=[];"string"==typeof b.classes?c=b.classes.split(","):Array.isArray(b.classes)&&(c=b.classes),"string"==typeof b.float&&a.hasOwnProperty(b.float)&&c.push(a[b.float]);var d=this.append('<div alia-context class=":class"></div>',{"class":c.join(" ")});return"object"==typeof b.width?(b.width.hasOwnProperty("percent")&&"number"==typeof b.width.percent&&(d.css("width",b.width.percent+"%"),d.css("white-space","nowrap"),d.css("overflow-x","auto")),b.width.hasOwnProperty("pixel")&&"number"==typeof b.width.pixel&&(d.css("width",b.width.pixel+"px"),d.css("white-space","nowrap"),d.css("overflow-x","auto"))):"string"==typeof b.width&&"auto"===b.width&&d.css("width","auto"),d.bindVisible(b.visible),d}}()),alia.defineLayout({name:"container"},function(){var a={fixed:"container",fluid:"container-fluid"};return function(b){var c=[];return"string"==typeof b.type&&a.hasOwnProperty(b.type)&&c.push(a[b.type]),this.append('<div alia-context class=":class"></div>',{"class":c.join(" ")})}}()),alia.defineLayout({name:"row"},function(a){var b=this.append('<div alia-context class="row"></div>');switch(typeof a.padding){case"object":"number"==typeof a.padding.top&&b.css("padding-top",a.padding.top+"px");case"number":}return b}),alia.defineLayout({name:"column"},function(){var a={large:"lg",medium:"md",small:"sm",xsmall:"xs"};return function(b){alia.applyDefaults(b,{visible:!0});var c=[];if(b.width&&"object"==typeof b.width&&!Array.isArray(b.width))for(var d in b.width)a.hasOwnProperty(d)&&c.push("col-"+a[d]+"-"+b.width[d]);if(b.offset&&"object"==typeof b.offset&&!Array.isArray(b.width))for(var d in b.offset)a.hasOwnProperty(d)&&c.push("col-"+a[d]+"-offset-"+b.offset[d]);var e=this.append('<div alia-context class=":class"></div>',{"class":c.join(" ")});return e.bindVisible(b.visible),e}}()),alia.defineLayout({name:"affix"},function(){return function(a){var b=this.append("<div alia-context></div>");return"number"==typeof a.top&&(b.css("position","fixed"),b.css("top",a.top)),b}}()),alia.defineLayout({name:"well"},function(){var a={large:"well-lg",small:"well-sm"};return function(b){var c=["well"];"string"==typeof b.size&&a.hasOwnProperty(b.size)&&c.push(a[b.size]);var d=this.append('<div alia-context class=":class"></div>',{"class":c.join(" ")});return d}}()),alia.defineLayout({name:"dropdown"},function(){return function(a){alia.applyDefaults(a,{visible:!0});var b=this.append(['<div alia-context class="dropdown">','  <a alia-context="toggler"></a>',"</div>"].join(""));return alia.isAccessor(a.text)?a.text.onResolve(function(a){$("#"+b.id("toggler")).html(a)}):$("#"+b.id("toggler")).html(a.text),$("html").click(function(){b.class("remove","open")}),$("#"+b.id("toggler")).click(function(a){b.class("add","open"),a.stopPropagation()}),b.bindVisible(a.visible),b}}()),alia.defineLayout({name:"dropdownMenu"},function(){return function(){return this.append('<ul alia-context class="dropdown-menu" role="menu"></ul>')}}()),alia.defineLayout({name:"dropdownItem"},function(){return function(){var a=this.append("<li alia-context></li>");return a}}()),alia.defineControl({name:"dropdownItem"},function(){return function(a){alia.applyDefaults(a,{visible:!0});var b=this.append('<li><a alia-context style="cursor: pointer"></a></li>').bindHtml("text",a.text);return"string"==typeof a.link&&b.attr("href",a.link),b.bindVisible(a.visible),b}}()),alia.defineControl({name:"dropdownDivider"},function(){return function(){return this.append('<li alia-context class="divider"></li>')}}()),alia.defineControl({name:"dropdownHeader"},function(){return function(a){var b=this.append('<li role="presentation" class="dropdown-header">:text</li>',{text:alia.getString(a.text)});return b.bindHtml("text",a.text),b}}()),alia.defineControl({name:"editableTextbox"},function(){var a={lines:9,length:5,width:1.5,radius:2.7,corners:.8,rotate:0,direction:1,color:"#000",speed:2.2,trail:45,shadow:!1,hwaccel:!1,className:"spinner"};return function(b){alia.applyDefaults(b,{type:"text",disabled:!1,visible:!0,deferred:!0});var c=this.append('<div alia-context class="editable-element text-toggle"></div>'),d=(alia.doText(c,{text:b.text}).class("add","editable-text").onClick(function(){c.class("toggle","text-toggle"),g.focus()}).onHover(function(){d.class("add","visible")},function(){d.class("remove","visible")}),alia.doIcon(c,{name:"pencil"})),e=c.append('<form alia-context class="editable-form"></form>'),f=e.append('<input alia-context type=":type">',{type:b.type}).onFocusOut(function(){b.deferred===!1&&(c.class("toggle","text-toggle"),l.isSettable()&&l.set(m.get()))}),g=$("#"+f.id());if(b.deferred){var h=e.append('<div alia-context class="save-options"></div>');alia.layoutButtonGroup(h,{size:"small"},function(a){var b=alia.doButton(a,{}).onClick(function(){var a=m.get(),b=function(){k.stop(),c.class("toggle","text-toggle"),l.set(a)},d=function(){k.stop(),console.log("reject")};k.spin(j),$(k.el).removeAttr("style"),c.emitSubmit(a,b,d)});alia.doIcon(b,{name:"ok"});var d=alia.doButton(a,{}).onClick(function(){c.class("toggle","text-toggle"),m.set(l.get())});alia.doIcon(d,{name:"remove"})});var i=c.append('<span alia-context class="spinner"></span>'),j=$("#"+i.id(""))[0],k=new Spinner(a)}var l=f.defineProperty("text",b.text),m=alia.state();return l.onResolve(b.deferred===!0?function(a){m.set(a),b.text.set(a)}:function(a){m.set(a)}),f.bindText("edited",m,b.type),c.defineEvent("submit"),c}}()),alia.defineControl({name:"editableBoolean"},function(){var a={lines:9,length:5,width:1.5,radius:2.7,corners:.8,rotate:0,direction:1,color:"#000",speed:2.2,trail:45,shadow:!1,hwaccel:!1,className:"spinner"};return function(b){alia.applyDefaults(b,{type:"t/f",disabled:!1,visible:!0});var c=this.append('<div alia-context class="editable-element text-toggle"></div>'),d=(alia.doText(c,{text:"function"==typeof b.map?b.map(b.value):b.value}).class("add","editable-text").onClick(function(){c.class("toggle","text-toggle")}).onHover(function(){d.class("add","visible")},function(){d.class("remove","visible")}),alia.doIcon(c,{name:"pencil"})),e=c.append('<form alia-context class="editable-form"></form>'),f=e.append(["<select alia-context>",'  <option value="true">:textTrue</option>','  <option value="false">:textFalse</option>',"</select>"].join(""),{textTrue:"t/f"===b.type?"True":"Yes",textFalse:"t/f"===b.type?"False":"No"}),g=e.append('<div alia-context class="save-options"></div>');alia.layoutButtonGroup(g,{size:"small"},function(a){var b=alia.doButton(a,{}).onClick(function(){var a="true"===l.get()?!0:!1,b=function(){j.stop(),c.class("toggle","text-toggle"),k.set(a)},d=function(){j.stop(),console.log("reject")};j.spin(i),$(j.el).removeAttr("style"),c.emitSubmit(a,b,d)});alia.doIcon(b,{name:"ok"});var d=alia.doButton(a,{}).onClick(function(){c.class("toggle","text-toggle"),l.set(k.get()?"true":"false")});alia.doIcon(d,{name:"remove"})});var h=c.append('<span alia-context class="spinner"></span>'),i=$("#"+h.id(""))[0],j=new Spinner(a),k=f.defineProperty("bool",b.value),l=alia.state(b.value===!0?"true":"false");return f.bindText("text",l,"text"),c.defineEvent("submit"),c}}()),alia.defineControl({name:"editableMarkdown"},function(){return function(a){alia.applyDefaults(a,{visible:!0});var b=this.append("<div alia-context>test</div>");return b}}()),alia.defineLayout({name:"form"},function(){var a={"default":"form",horizontal:"form-horizontal",inline:"form-inline"},b={left:"navbar-form navbar-left",right:"navbar-form navbar-right"};return function(c){"string"==typeof c.style&&a.hasOwnProperty(c.style)||(c.style=a.default);var d=[a[c.style]];"string"==typeof c.position&&b.hasOwnProperty(c.position)&&d.push(b[c.position]);var e=this.append('<form alia-context class=":class"></form>',{"class":d.join(" ")});return e.defineStatic("style",c.style),e}}()),alia.defineLayout({name:"formField"},function(){var a={large:"lg",medium:"md",small:"sm",xsmall:"xs"};return function(b){switch(this.style){case"horizontal":var c=["control-label"];if("object"==typeof b.labelwidth&&!Array.isArray(b.labelwidth))for(var d in b.labelwidth)a.hasOwnProperty(d)&&c.push("col-"+a[d]+"-"+b.labelwidth[d]);if("object"==typeof b.labeloffset&&!Array.isArray(b.labeloffset))for(var d in b.labeloffset)a.hasOwnProperty(d)&&c.push("col-"+a[d]+"-offset-"+b.labeloffset[d]);var e=[];if("object"==typeof b.width&&!Array.isArray(b.width))for(var d in b.width)a.hasOwnProperty(d)&&e.push("col-"+a[d]+"-"+b.width[d]);if("object"==typeof b.offset&&!Array.isArray(b.offset))for(var d in b.offset)a.hasOwnProperty(d)&&e.push("col-"+a[d]+"-offset-"+b.offset[d]);return"string"==typeof b.special&&"checkbox"===b.special?this.append('<div class="form-group">  <div class=":class">    <div class="checkbox">      <label alia-context></label>    </div>  </div></div>',{"class":e.join(" ")}):"string"==typeof b.special&&"button"===b.special?this.append('<div class="form-group">  <div alia-context class=":class">  </div></div>',{"class":e.join(" ")}):this.append('<div class="form-group">  <label class=":labelclass">:text</label>  <div alia-context class=":class"></div></div>',{labelclass:c.join(" "),"class":e.join(" "),text:alia.getString(b.text)});case"inline":case"default":var c=["sr-only"];return"boolean"==typeof b.checkbox&&b.checkbox?this.append('<div class="checkbox">  <label alia-context></label></div>',{}):this.append('<div alia-context class="form-group">  <label class=":labelclass">:text</label></div>',{labelclass:c.join(" "),text:alia.getString(b.text)})}}}()),alia.defineControl({name:"form"},function(){function a(a,b,c,d){switch(b.type){case"checkbox":alia.layoutFormField(a,{special:"checkbox",offset:d.label,width:d.control},function(a){alia.doCheckbox(a,{checked:c.property(b.lens)}),alia.doText(a,{text:b.label})});break;case"textbox":alia.layoutFormField(a,{text:b.label,labelwidth:d.label,width:d.control},function(a){alia.doTextbox(a,{text:c.property(b.lens),type:b.datatype||"text",placeholder:b.placeholder||"",disabled:b.disabled})});break;case"typeahead":alia.layoutFormField(a,{text:b.label,labelwidth:d.label,width:d.control},function(a){alia.doTypeahead(a,{value:c.property(b.lens),type:b.sourcetype,pool:b.source,editable:b.editable})});break;case"datepicker":alia.layoutFormField(a,{text:b.label,labelwidth:d.label,width:d.control},function(a){alia.doDatepicker(a,{placeholder:"Enter Date",date:c.property(b.lens)})})}}return function(b){var c,d=this.append("<div alia-context></div>");c=alia.isAccessor(b.model)?b.model:alia.state(b.model);var e=b.fields,f=b.buttons;return alia.layoutForm(d,{style:"horizontal"},function(d){for(var g=0;g<e.length;++g){var h=e[g];a(d,h,c,b),Array.isArray(f)&&alia.layoutFormField(d,{special:"button",offset:b.label,width:b.control},function(a){alia.layoutButtonGroup(a,{},function(a){for(var b=0;b<f.length;++b)alia.doButton(a,{text:f[b].text}).onClick(function(a){return f[a].action}(b))})})}}),d.getData=function(){return c.get()},d.refresh=function(){},d}}()),alia.defineControl({name:"icon"},function(){return function(a){var b=["glyphicon"];"string"==typeof a.name&&b.push("glyphicon-"+a.name);var c=this.append('<span alia-context class=":class"> </span>',{"class":b.join(" ")});return alia.isAccessor(a.name)&&a.name.onResolve(function(a){var b=["glyphicon"];"string"==typeof a&&b.push("glyphicon-"+a),c.removeAttr("class"),c.attr("class",b.join(" "))}),c}}()),alia.defineControl({name:"textbox"},function(){var a={large:"input-lg",small:"imput-sm"},b={text:"text",email:"email",number:"number",password:"password"};return function(c){alia.applyDefaults(c,{type:b.text,disabled:!1,visible:!0});var d=["form-control"];"string"==typeof c.size&&a.hasOwnProperty(c.size)&&d.push(a[c.size]);var e=this.append('<input alia-context type=":type" class=":class">',{type:c.type,"class":d.join(" ")});return"string"==typeof c.placeholder&&e.attr("placeholder",c.placeholder),e.bindDisabled(c.disabled),e.bindText(c.text,c.type),e.bindVisible(c.visible),e}}()),alia.defineControl({name:"checkbox"},function(){return function(a){alia.applyDefaults(a,{checked:!1,visible:!0});var b=this.append('<input alia-context type="checkbox">'),c=b.defineProperty("checked",a.checked);return b.bindCheckboxField(c),b.bindVisible(a.visible),b}}()),alia.defineControl({name:"textarea"},function(){return function(a){alia.applyDefaults(a,{visible:!0,resize:"both"});var b=this.append('<textarea alia-context rows=":rows" class="form-control" style="resize::resize"></textarea>',{rows:a.rows,resize:a.resize});return"string"==typeof a.placeholder&&b.attr("placeholder",a.placeholder),b.css("width","100%"),b.bindText(a.text,"text"),b.bindVisible(a.visible),b}}()),alia.defineControl({name:"select"},function(){function a(a,b){if(Array.isArray(b)){for(var c=0;c<b.length;++c){var d=b[c];"string"==typeof d||"number"==typeof d?a.append('<option value=":text">:text</option>',{text:d}):a.append('<option value=":value">:text</option>',{value:d.hasOwnProperty("value")?d.value:d.text,text:d.text})}$("#"+a.id()).trigger("change")}}function b(a,b){var d=0;b.property(".length").onResolve(function(e){if(d>e)d=e;else for(var f=d;e>f;++f){var g=b.at(f);c(a,g)}})}function c(a,b){var c;b.observe(function(b){"string"==typeof b||"number"==typeof b?(c=a.append('<option value=":text">:text</option>',{text:b}),$("#"+a.id()).trigger("change")):(c=a.append('<option value=":value">:text</option>',{value:b.hasOwnProperty("value")?b.value:b.text,text:b.text}),$("#"+a.id()).trigger("change"))},function(){"undefined"!=typeof c&&($("#"+c.id()).remove(),c=void 0),$("#"+a.id()).trigger("change")},null)}return function(c){alia.applyDefaults(c,{visible:!0});var d=this.append('<select alia-context class="form-control"></select>');d.bindSelectValue(c.selected),d.bindVisible(c.visible);return alia.isAccessor(c.options)?b(d,c.options):a(d,c.options),d}}()),alia.defineControl({name:"datepicker"},function(){return function(a){alia.applyDefaults(a,{visible:!0});var b=this.append('<input alia-context type="text" class="form-control">');return $("#"+b.id()).datepicker({startDate:a.startDate,endDate:a.endDate}),"string"==typeof a.placeholder&&b.attr("placeholder",a.placeholder),b.bindDate(a.date),b.bindVisible(a.visible),b}}()),alia.defineControl({name:"typeahead"},function(){var a={large:"input-lg",small:"imput-sm"};return function(b){function c(){d.clear();for(var a in g)d.add(g[a])}var d;"string"===b.type?d=new Bloodhound({datumTokenizer:function(a){return Bloodhound.tokenizers.whitespace(a)},queryTokenizer:Bloodhound.tokenizers.whitespace,limit:10,local:[]}):"object"===b.type&&(d=new Bloodhound({datumTokenizer:function(a){return Bloodhound.tokenizers.whitespace(a.display)},queryTokenizer:Bloodhound.tokenizers.whitespace,limit:10,local:[]})),d.initialize(),alia.applyDefaults(b,{disabled:!1,visible:!0});var e=["form-control"];"string"==typeof b.size&&a.hasOwnProperty(b.size)&&e.push(a[b.size]);var f=this.append('<input alia-context type="text" class=":class">',{"class":e.join(" ")});$("#"+f.id()).typeahead({hint:!0,highlight:!0,minLength:1},{name:"typeahead-dataset",displayKey:function(a){return"string"===b.type?a:"object"===b.type?a.display:void 0},source:d.ttAdapter()}),"string"==typeof b.placeholder&&f.attr("placeholder",b.placeholder);var g={};if(alia.isAccessor(b.pool))b.pool.onResolve(function(a){g[0]=a,c()});else if(Array.isArray(b.pool))for(var h=0;h<b.pool.length;++h)alia.isAccessor(b.pool[h])&&b.pool[h].onResolve(function(a){return function(b){g[a]=JSON.parse(JSON.stringify(b)),c()}}(h));f.bindDisabled(b.disabled),f.bindText(b.text,"text"),f.bindVisible(b.visible);var i=f.defineProperty("value",b.value);return f.onFocusOut(function(){var a=!1;f.text.set($("#"+f.id()).typeahead("val"));var c=f.text.get();""===c&&i.set(null);for(var d in g){for(var e=0;e<g[d].length;++e){if("string"===b.type&&g[d][e]===c){i.set(c),a=!0;break}if("object"===b.type&&g[d][e].display===c){i.set(g[d][e].key),a=!0;break}}if(a)break}a||b.editable?!a&&b.editable&&i.set(c):(f.text.set(""),$("#"+f.id()).typeahead("val",""))}),f}}()),alia.defineControl({name:"repeat"},function(){return function(a){function b(){c.empty();for(var b=0;e>b;++b){var f=c.append("<div alia-context></div>"),g=d.at(b);a.callback.call(null,f,g)}}var c=this.append("<div alia-context></div>"),d=alia.state(a.data),e=null;return d.onResolve(function(a){a.length!==e&&(e=a.length,b())}),c.defineProperty("data",d),b(),c}}()),alia.defineLayout({name:"jumbotron"},function(){return function(a){return this.append("extend"===a.type?'<div class="jumbotron"><div alia-context class="container"></div></div>':'<div alia-context class="jumbotron" id=":id"></div>')}}()),alia.defineLayout({name:"unorderedList"},function(){return this.append("<ul alia-context></ul>")}),alia.defineLayout({name:"orderedList"},function(){return this.append("<ol alia-context></ol>")}),alia.defineLayout({name:"listItem"},function(){return this.append("<li alia-context></li>")}),alia.defineLayout({name:"descriptionList"},function(){var a={"default":null,horizontal:"dl-horizontal"};return function(b){return alia.applyDefaults(b,{visible:!0,style:"default"},{style:a}),this.append('<dl alia-context class=":class"></dl>',{"class":_.compact([a[b.style]]).join("")})}}()),alia.defineLayout({name:"descriptionTerm"},function(){return this.append("<dt alia-context></dt>")}),alia.defineLayout({name:"descriptionItem"},function(){return this.append("<dd alia-context></dd>")}),alia.defineControl({name:"descriptionList"},function(a){var b=alia.layoutDescriptionList(this,a,function(b){for(var c=0;c<a.items.length;++c)alia.layoutDescriptionTerm(b,{},function(b){alia.doText(b,{text:a.items[c].term})}),alia.layoutDescriptionItem(b,{},function(b){alia.doText(b,{text:a.items[c].description})})});return b}),alia.defineLayout({name:"listGroup"},function(){return function(){return this.append('<ul alia-context class="list-group"></ul>')}}()),alia.defineLayout({name:"listGroupItem"},function(){var a={"default":null,success:"list-group-item-success",info:"list-group-item-info",warning:"list-group-item-warning",danger:"list-group-item-danger"};return function(b){alia.applyDefaults(b,{visible:!0,style:"default"},{style:a});var c=this.append('<ul alia-context class=":class"></ul>',{"class":_.compact(["list-group-item",a[b.style]]).join("")});return c.bindVisible(b.visible),c}}()),alia.defineControl({name:"listGroup"},function(){return function(){}}()),alia.defineControl({name:"image"},function(){var a={rounded:"img-rounded",circle:"img-circle",thumbnail:"img-thumbnail"};return function(b){var c=[];"string"==typeof b.style&&a.hasOwnProperty(b.style)&&c.push(a[b.style]),"boolean"==typeof b.responsive&&b.responsive&&c.push("img-responsive");var d=":text";"object"==typeof b.link&&b.link.hasOwnProperty("href")&&(d=alia.replace('<a href=":href">:text</a>',{href:b.link}));var e=this.append(alia.replace(d,{text:'<img src=":source" alt=":alt" class=":class">'}),{source:b.source,alt:b.alt||"","class":c.join(" ")});return e}}()),alia.defineLayout({name:"media"},function(){return function(a){var b=['<div class="media" style="cursor:pointer">','  <a class="pull-left">','    <img class="media-object" src=":source" alt=":alt">',"  </a>",'  <div alia-context class="media-body"></div>',"</div>"],c=this.append(b.join(""),{source:a.source,alt:a.alt||""});return c}}()),alia.defineLayout({name:"modal"},function(){var a={large:"modal-lg",small:"modal-sm"};return function(b){var c="",d=["modal-dialog"];"string"==typeof b.size&&a.hasOwnProperty(b.size)&&d.push(a[b.size]),("undefined"==typeof b.fade||b.fade===!0)&&(c="fade");var e='<div alia-context class="modal :fade" tabindex="-1" role="dialog" aria-labelledby=":title" aria-hidden="true">  <div class=":class">    <div alia-context="content" class="modal-content"></div>  </div></div>',f=this.append(e,{title:b.title,"class":d.join(" "),fade:c});return $("#"+f.id()).modal({backdrop:"static",show:!1}),f.hide=function(){$("#"+f.id()).modal("hide")},f.show=function(){$("#"+f.id()).modal("show")},$("#"+f.id()).on("shown.bs.modal",function(){$("#"+f.id()+' form:first *:input[type!=hidden][disabled!="disabled"][class!="form-control tt-hint"]:first').focus()}),f}}()),alia.defineLayout({name:"modalHeader"},function(){return this.append("content",'<div alia-context class="modal-header"></div>')}),alia.defineLayout({name:"modalBody"},function(){return this.append("content",'<div alia-context class="modal-body"></div>')}),alia.defineLayout({name:"modalFooter"},function(){return this.append("content",'<div alia-context class="modal-footer"></div>')}),alia.defineControl({name:"modalForm"},function(){var a={text:{type:"string","default":"",inputType:"textbox"},number:{type:"number","default":0,inputType:"textbox"},"boolean":{type:"boolean","default":!0,inputType:"checkbox"},typeahead:{"default":"",inputType:"typeahead"},datepicker:{"default":"",inputType:"datepicker"}};return function(b){for(var c={},d=[],e=0;e<b.fields.length;++e){var f=b.fields[e];if("string"!=typeof f.name)throw new Error("Invalid form field name");var g,h;"string"==typeof f.type&&a.hasOwnProperty(f.type)?(g=f.type,h=a[f.type]):(g="text",h=a.text),alia.isAccessor(b.formdata)||(c[f.name]=typeof f.initValue===h.type?f.initValue:h.default);var i={type:h.inputType,label:f.label,lens:"."+f.name,datatype:g,placeholder:f.placeholder||"",disabled:f.disabled||!1};"typeahead"===i.type&&(i.sourcetype=f.sourcetype,i.source=f.source,i.editable=f.editable),d.push(i)}alia.isAccessor(b.formData)&&(c=b.formData);var j=alia.state(!1),k=alia.state(null),l=alia.layoutModal(this,{size:b.size,title:b.title,fade:b.fade},function(a){var e=a;alia.layoutModalHeader(a,{},function(a){alia.doButton(a,{close:!0,text:"&times;"}).onClick(function(){j.set(!1),k.set(null),l.hide()}),alia.layoutHeading(a,{type:4,text:b.title},function(){})});var f;alia.layoutModalBody(a,{},function(a){f=alia.doForm(a,{label:{large:3,small:4},control:{large:9,small:8},model:c,fields:d})}),alia.layoutModalFooter(a,{},function(a){alia.doText(a,{text:k,style:"danger",visible:k.then(alia.isNotEmptyString)}),alia.doText(a,{text:"&nbsp;&nbsp;&nbsp;"}),alia.doButton(a,{text:"Cancel",disabled:j}).onClick(function(){f.refresh(),k.set(null),l.hide()});var c=alia.doButton(a,{text:"Save",style:"primary",loading:j,loadingStyle:"expand-right"}).onClick(function(){j.set(!0);var a=f.getData(),b=function(){j.set(!1),k.set(null),l.hide(),f.refresh()},c=function(a){j.set(!1),k.set(a)};l.emitSubmit(a,b,c)});b.onEnterKeySubmit&&e.onEnterKey(function(){c.doClick()})})});return l.defineEvent("Submit"),l}}()),alia.defineLayout({name:"multiviewNavigationLinkset"},function(){return function(){var a=this.append('<ul alia-context class="mulitview-navigation-linkset"></ul>'),b=this;return a.push=function(){return b.push.apply(b,arguments),this},a}}()),alia.defineControl({name:"multiviewNavigationHeader"},function(){return function(a){var b=this.append('<li role="presentation" class="multiview-navigation-header">:text</li>',{text:alia.getString(a.text)});return b.bindHtml(b.defineProperty("text",a.text)),b}}()),alia.defineControl({name:"multiviewNavigationItem"},function(){return function(a){alia.applyDefaults(a,{visible:!0});var b;if(a.hasOwnProperty("view")){var b=this.append('<li><a alia-context style="cursor: pointer;">:text</a></li>',{link:a.link,text:alia.getString(a.text)}).onClick(function(){this.push(a.view,a.query)}.bind(this));b.bindHtml("text",a.text)}else if(a.hasOwnProperty("link")){var b=this.append('<li><a alia-context href=":link">:text</a></li>',{link:a.link,text:alia.getString(a.text)});b.bindHtml("text",a.text)}return b.bindVisible(a.visible),b}}()),alia.defineControl({name:"multiviewNavigationDivider"},function(){return function(){return this.append('<li alia-context class="divider"></li>')}}()),alia.defineLayout({name:"navbar"},function(){var a={"default":"navbar-default",inverse:"navbar-inverse"},b={top:"navbar-fixed-top",bottom:"navbar-fixed-bottom"};return function(c){var d=["navbar"];d.push("string"==typeof c.style&&a.hasOwnProperty(c.style)?a[c.style]:a.default),"string"==typeof c.fixed&&b.hasOwnProperty(c.fixed)&&d.push(b[c.fixed]);var e,f='<nav class=":class" role="navigation">  <div alia-context class="container-fluid"></div></nav>',g=this.append(f,{"class":d.join(" ")});e="string"==typeof c.brand?c.brand:"Brand";var h=g.append('<div class="navbar-header">  <button alia-context="collapse" type="button" class="navbar-toggle" data-toggle="collapse">    <span class="sr-only">Toggle navigation</span>    <span class="icon-bar"></span>    <span class="icon-bar"></span>    <span class="icon-bar"></span>  </button>  <a class="navbar-brand" href="#">:brand</a></div>',{brand:e}),i=g.append('<div alia-context class="collapse navbar-collapse">  <ul alia-context="nav" class="nav navbar-nav"></ul></div>');return h.kattr("collapse","data-target","#"+i.id()),i}}()),alia.defineLayout({name:"navbarForm"},function(){return function(){return this.append('<form alia-context class="navbar-form navbar-left"></form>')}}()),alia.defineLayout({name:"navbarRight"},function(){return function(){return this.append('<ul alia-context="nav" class="nav navbar-nav navbar-right"></ul>')}}()),alia.defineControl({name:"navbarLink"},function(){return function(a){var b=this.append("nav",'<li><a alia-context href=":link"></a></li>',{link:a.link}),c=$("#"+b.id()),d=b.defineProperty("text",a.text);
return d.onResolve(function(a){c.html(a)}),d.onError(function(){c.empty()}),b}}()),alia.defineLayout({name:"navbarDropdown"},function(){return function(a){alia.applyDefaults(a,{visible:!0});var b='<li alia-context="dropdown" class="dropdown">  <a alia-context="link" class="dropdown-toggle" style="cursor:pointer;" data-toggle="dropdown">:text <b class="caret"></b></a>  <ul alia-context class="dropdown-menu"></ul></li>',c=this.append("nav",b,{link:a.link});c.bindVisible("dropdown",a.visible);var d=c.defineProperty("text",a.text);return d.onResolve(function(a){c.khtml("link",a+' <b class="caret"></b>')}),d.onError(function(){c.khtml("link","")}),c}}()),alia.defineLayout({name:"panel"},function(){var a={"default":"panel-default",primary:"panel-primary",success:"panel-success",info:"panel-info",warning:"panel-warning",danger:"panel-danger"},b={"default":null,h1:"h1",h2:"h2",h3:"h3",h4:"h4",h5:"h5",h6:"h6"};return function(c){alia.applyDefaults(c,{style:"default",headerStyle:"default",visible:!0,collapsible:!1,collapsed:!1},{style:a,headerStyle:b});var d='<div alia-context="div" class="panel :style">';c.header&&(d+=c.headerStyle?'<div class="panel-heading"><:hs alia-context="header" class="panel-title"></:hs></div>':'<div alia-context="header" class="panel-heading"></div>'),d+='<div alia-context class="panel-body"></div>',c.footer&&(d+='<div alia-context="footer" class="panel-footer"></div>'),d+="</div>";var e=this.append(d,{style:a[c.style],hs:b[c.headerStyle]});if(e.bindVisible("div",c.visible),c.collapsible&&(e.bindCollapse("",c.collapsed),c.headerStyle?$("#"+e.id("header")).parent().click(function(){e.collapsed.set(!e.collapsed.get())}):$("#"+e.id("header")).click(function(){e.collapsed.set(!e.collapsed.get())})),c.header){var f=e.defineProperty("header",c.header);f.onResolve(function(a){$("#"+e.id("header")).html(a)})}if(c.footer){var f=e.defineProperty("footer",c.footer);f.onResolve(function(a){$("#"+e.id("footer")).html(a)})}return e}}()),alia.defineControl({name:"progress"},function(){var a={success:"progress-bar-success",info:"progress-bar-info",warning:"progress-bar-warning",danger:"progress-bar-danger"};return function(b){var c=["progress-bar"],d="";"boolean"==typeof b.rating&&b.rating===!0&&(d="progress-rating"),"string"==typeof b.style&&a.hasOwnProperty(b.style)&&c.push(a[b.style]);var e=['<div class="progress :rating">','  <div class=":class :rating" role="progressbar" aria-valuenow=":now" aria-valuemin="0" aria-valuemax="100" style="width::now%">:now%</div>',"</div>"],f=this.append(e.join(""),{now:b.now,rating:d,"class":c.join(" ")});return f}}()),alia.defineControl({name:"pageSpinner"},function(){var a={lines:13,length:20,width:10,radius:30,corners:1,rotate:0,direction:1,color:"#000",speed:1,trail:60,shadow:!1,hwaccel:!1,className:"table-spinner"};return function(){var b=alia.viewport.append('<div alia-context class="page-spinner-background"></div>'),c=$("#"+b.id())[0],d=new Spinner(a);return d.spin(c),$("#"+b.id()).attr("style",""),b.stop=function(){d.stop(),$("#"+b.id()).remove()},b}}()),alia.defineLayout({name:"table"},function(){var a={bordered:"table-bordered",striped:"table-striped",hover:"table-hover",condensed:"table-condensed"};return function(b){var c,d=[];if("string"==typeof b.style?c=b.style.split(","):Array.isArray(b.style)&&(c=b.style),c)for(var e=0;e<c.length;e++)a.hasOwnProperty(c[e])&&d.push(a[c[e]]);return this.append('<table alia-context class="table :class"></table>',{"class":d.join(" ")})}}()),alia.defineLayout({name:"tableRow"},function(){var a={active:"active",success:"success",warning:"warning",danger:"danger",info:"info"};return function(b){var c;return c=this.append("heading"===b.type?"<thead><tr alia-context></tr></thead>":"<tr alia-context></tr>"),c.defineProperty("style",b.style),"boolean"==typeof b.selectable&&b.selectable&&c.css("cursor","pointer"),c.style.onResolve(function(b){"string"==typeof b&&a.hasOwnProperty(b)?c.attr("class",a[b]):c.removeAttr("class")}),c}}()),alia.defineLayout({name:"tableCell"},function(){return function(a){var b="heading"===a.type?"h":"d",c=this.append("<t:type alia-context></t:type>",{type:b});return a.hasOwnProperty("sortable")&&a.sortable===!0&&(c.css("cursor","pointer"),c.defineProperty("sortOrder",""),c.onClick(function(){c.sortOrder.set(""===c.sortOrder.get()?"A":"A"===c.sortOrder.get()?"D":"")}),alia.doText(c,{style:"info",text:c.sortOrder}).class("add","pull-right")),c}}()),alia.defineControl({name:"table"},function(){function a(a){var b,c=["table"];if("string"==typeof a.style?b=a.style.split(","):Array.isArray(a.style)&&(b=a.style),b)for(var d=0;d<b.length;d++)u.hasOwnProperty(b[d])&&c.push(u[b[d]]);return c}function b(a,b){var c=[];return alia.layoutTableRow(a,{},function(a){for(var d=0;d<b.fields.length;++d)b.fields[d].hidden||c.push(alia.layoutTableCell(a,{type:"heading",sortable:b.sortable},function(a){alia.doText(a,{text:b.fields[d].heading})}).sortOrder);b.removable===!0&&alia.layoutTableCell(a,{type:"heading"},function(a){var c=alia.doButton(a,{style:"link"}).onClick(function(){b.data.set([])});c.css("padding","0"),alia.doText(c,{text:" Delete All "}),alia.doIcon(c,{name:"remove"})})}),alia.all(c)}function c(a,b,c,e){$("#"+b.id()).empty();var f=0;c.data.property(".length").onResolve(function(g){if(f>g)f=g;else for(var h=f;g>h;++h)d(a,b,c,h,e,function(a){return function(){for(var b=e.get(),c=b.splice(a,1)[0],d=0;d<b.length;++d)b[d]>c&&b[d]--;e.set(b)}}(h)),f++})}function d(a,b,c,d,f,g){alia.layoutTableRow(b,{selectable:c.selectable,style:a.currentRow.then(function(a){return a===d?"info":""})},function(b){c.data.at(d).onUnresolve(function(){$("#"+b.id()).remove(),g()}),c.clickable===!0&&b.css("cursor","pointer"),b.onClick(function(){a.emitRowClick(c.data.get()[d])}),c.selectable===!0&&b.onClick(function(){a.currentRow.set(d),a.currentItem.set(c.data.get()[d])});for(var f=0;f<c.fields.length;++f)e(b,c,d,f);c.removable===!0&&alia.layoutTableCell(b,{},function(a){var b=alia.doButton(a,{style:"link"}).onClick(function(){var a=c.data.get();a.splice(d,1),c.data.set(a)});b.css("padding","0"),alia.doIcon(b,{name:"remove"})})})}function e(a,b,c,d){alia.layoutTableCell(a,{},function(a){f(a,b,c,d),b.fields[d].hidden===!0&&$("#"+a.id()).hide()})}function f(a,b,c,d){var e,f=b.data,g=b.fields[d];if(e="function"==typeof g.map?f.property("."+c+g.property).then(g.map):f.property("."+c+g.property),"string"==typeof g.editableType)switch(a.css("padding","0"),g.editableType){case"number":case"text":alia.doEditableTextbox(a,{type:g.editableType,text:e,deferred:!1})}else alia.doText(a,{text:e})}function g(a,b){if("."===b.substr(0,1)&&(b=b.substring(1,b.length)),"string"==typeof b){var c=b.split("."),d=a[c.shift()];return 0===c.length?d:g(d,c.join("."))}return"number"==typeof b?a[b]:void 0}function h(a,b){return a==b?0:b>a?-1:1}function i(a,b){var c=h,d=h;return a&&(d=function(b,d){return c(a(b),a(d))}),""===b?function(){return 0}:"D"===b?function(a,b){return-1*d(a,b)}:d}function j(a,b){for(var c=b.fields,d=[],e=0,f=0;f<c.length;++f)c[f].hidden||(d.push({property:c[f].property,cmp:i(c[f].sortPrimer,a[e])}),e++);return d}function k(a,b,c,d,e){alia.join(a,b.data,function(a,b){return[a,b]}).onResolve(function(a){var f=d.get();if(f.length<a[1].length){for(var g=f.length;g<a[1].length;++g)f[g]=g;d.set(f)}var h=j(a[0],b);d.set(p(a[1],h,c,d.get())),e()})}function l(a,b,c,d){var e=b[c];b[c]=b[d],b[d]=e;var f=$("#"+a.id()+" tr:nth-child("+(c+1)+")"),g=$("#"+a.id()+" tr:nth-child("+(d+1)+")"),h=f.next();h.is(g)?g.insertBefore(f):(f.insertBefore(g),g.insertBefore(h))}function m(a,b,c,d,e,f){for(var h=Math.floor((f+e)/2),i=e,j=f;j>=i;){var k;do{if(i==h)break;for(var m=0;m<c.length;++m){var n=g(a[b[i]],c[m].property),o=g(a[b[h]],c[m].property);if(k=c[m].cmp(n,o),0!==k)break}0>k&&i++}while(0>k);do{if(j==h)break;for(var m=0;m<c.length;++m){var n=g(a[b[j]],c[m].property),o=g(a[b[h]],c[m].property);if(k=c[m].cmp(n,o),0!==k)break}k>0&&j--}while(k>0);j>=i&&(l(d,b,i,j),h==i?h=j:h==j&&(h=i),i++,j--)}return i}function n(a,b,c,d,e,f){var g;a.length>1&&(g=m(a,b,c,d,e,f),g-1>e&&n(a,b,c,d,e,g-1),f>g&&n(a,b,c,d,g,f))}function o(a,b){for(var c=[],d=0;d<a.length;++d)c[a[d]]=$("#"+b.id()+" tr:nth-child("+(d+1)+")");for(var d=0;d<c.length;++d)$("#"+b.id()).append(c[d])}function p(a,b,c,d){null!==d&&o(d,c);for(var e=[],f=0;f<a.length;++f)e.push(f);return n(a,e,b,c,0,a.length-1),e}function q(a,b){var c=[];return b&&$("#"+a.id()+" tr").each(function(a,d){$(d).show();var e=!1;$(d).children("td").each(function(a,c){var d=$(c).text();return d.toLowerCase().indexOf(b.toLowerCase())>-1?(e=!0,!1):void 0}),e||($(d).hide(),c.push(a))}),c}function r(a,b,c){for(var d=0;d<c.length;++d)"string"==typeof c[d]&&$("#"+a.id()+" tr").each(function(a,e){if(b.indexOf(a)<0){var f=$(e).children("td:nth-child("+(d+1)+")"),g=f.text();g.toLowerCase().indexOf(c[d].toLowerCase())<0&&($(e).hide(),b.push(a))}});b.sort(function(a,b){return a-b})}function s(a,b,c,d,e){var f=d-e.length,g=Math.ceil(f/c);$("#"+a.id()).empty();for(var h=0;g>h;++h)alia.layoutListItem(a,{},function(f){alia.doLink(f,{text:h+1+""}).onClick(function(f){return function(){t(a,b,e,d,f,c)}}(h))});t(a,b,e,d,0,c)}function t(a,b,c,d,e,f){$("#"+a.id()+".pagination li").removeClass("active"),$("#"+a.id()+".pagination li:nth-child("+(e+1)+")").addClass("active");for(var g=0,h=c[g],i=0,j=0;d>j;++j)j!==h?(e*f>i||i>=(e+1)*f?$("#"+b.id()+" tr:nth-child("+(j+1)+")").css("display","none"):$("#"+b.id()+" tr:nth-child("+(j+1)+")").css("display","table-row"),i++):h=c[++g]}var u={bordered:"table-bordered",striped:"table-striped",hover:"table-hover",condensed:"table-condensed"},v={lines:9,length:5,width:1.5,radius:2.7,corners:.8,rotate:0,direction:1,color:"#000",speed:2.2,trail:45,shadow:!1,hwaccel:!1,className:"table-spinner"};return function(d){alia.applyDefaults(d,{sortable:!1,selectable:!1,removable:!1,spinner:!1,clickable:!1,visible:!0});var e,f,g=a(d),h=this.append('<table alia-context class=":class"></table>',{"class":g.join(" ")});h.defineProperty("currentItem",null),h.defineProperty("currentRow",null);var i=d.fields.length;d.removable===!0&&i++;var j=h.append("<thead alia-context></thead>"),l=h.append("<tbody alia-context></tbody>"),m=h.append('<tfoot><tr><td alia-context colspan=":span" class="footer-cell"></td></tr></tfoot>',{span:i});if("object"==typeof d.paging&&"number"==typeof d.paging.default&&Array.isArray(d.paging.options)&&(alia.layoutUnorderedList(m,{},function(a){f=a,a.class("add","pagination")}),e=alia.doSelect(m,{selected:d.paging.default,options:d.paging.options}).class("add","pull-right").selected,alia.doText(m,{weight:"bold",text:"Page Size: "}).class("add","pull-right").css("margin-right","5px").css("position","relative").css("top","7px")),d.spinner===!0){var n=$("#"+m.id(""))[0],o=new Spinner(v);o.spin(n),d.data.observe(function(){o.stop()},function(){o.spin(n)},null)}var p=b(j,d,l),t=[];if("undefined"!=typeof d.data.get())for(var u=0;u<d.data.get().length;++u)t.push(u);var w=alia.state(t);c(h,l,d,w);for(var x=[],u=0;u<d.fields.length;++u)x.push(alia.isAccessor(d.fields[u].filter)?d.fields[u].filter:null);var y=alia.all(x);return k(p,d,l,w,function(){"object"==typeof d.paging&&"number"==typeof d.paging.default&&Array.isArray(d.paging.options)&&alia.all([e,d.data,d.filter,y]).onResolve(function(a){var b=[],c=a[0];"string"==typeof a[2]&&(b=q(l,a[2])),Array.isArray(a[3])&&r(l,b,a[3]),"number"!=typeof a[0]&&(c=parseInt(a[0])),s(f,l,c,a[1].length,b)})}),h.bindVisible(d.visible),h.defineEvent("RowClick"),h}}()),alia.defineControl({name:"propertyTable"},function(){function a(a,b,c){var d;return d="function"==typeof b.map?alia.doText(a,{text:c.property("."+b.name).then(b.map)}):alia.doText(a,{text:c.property("."+b.name)}),d.class("add","normal"),d.width()+13}function b(a,b,c,d){var e;switch(b.editableType){case"number":case"text":e=alia.doEditableTextbox(a,{type:b.editableType,text:c.property("."+b.name),deferred:d}).onSubmit(b.onSubmit);break;case"boolean":e=alia.doEditableBoolean(a,{type:"y/n",value:c.property("."+b.name),map:b.map,deferred:d}).onSubmit(b.onSubmit);break;default:throw new Error("Cannot render editable type "+b.editableType)}return e.width()}function c(c,d){alia.layoutDiv(c,{classes:"property-list"},function(c){var e=0;d.newLine?c.class("add","skinny"):c.onResize(function(a){2*(e+150)>a?c.class("add","skinny"):c.class("remove","skinny")}),d.data.onResolve(function(){c.empty(),alia.layoutUnorderedList(c,{},function(c){for(var f=0;f<d.fields.length;++f){var g=d.fields[f];alia.layoutListItem(c,{},function(c){c.class("add","item"),f%2==1&&c.class("add","item-right"),alia.layoutDiv(c,{classes:"wrap"},function(c){alia.doText(c,{text:g.label+":"}).class("add","name").class("add","text-muted"),e="string"==typeof g.editableType&&"function"==typeof g.onSubmit?Math.max(b(c,g,d.data,d.deferred),e):Math.max(a(c,g,d.data,d.deferred),e)})})}})})})}return function(a){alia.applyDefaults(a,{deferred:!0});var b=this.append("<div alia-context></div>");c(b,a)}}()),alia.defineLayout({name:"tabset"},function(){var a={horizontal:"horizontal",vertical:"vertical"};return function(b){alia.applyDefaults(b,{visible:!0});var c=a[b.style]||a.horizontal,d="";d="horizontal"===c?'<div class="container-fluid" alia-context>  <div class="row">    <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">      <ul alia-context="nav" class="nav nav-tabs"></ul>      <div alia-context="content" class="tab-content"></div>    </div>  </div></div>':'<div class="container-fluid" alia-context>  <div class="row">    <div class="col-lg-3 col-md-3 col-sm-4 col-xs-5">      <ul alia-context="nav" class="nav nav-pills nav-stacked"></ul>    </div>    <div class="col-lg-9 col-md-9 col-sm-8 col-xs-7">      <div alia-context="content" class="tab-content"></div>    </div>  </div></div>';var e=this.append(d);return e.bindVisible(b.visible),e}}()),alia.defineLayout({name:"tab"},function(){return function(a){var b=[];"boolean"==typeof a.active&&a.active&&b.push("active");{var c=this.append("content",'<div alia-context class="tab-pane :class"></div>',{"class":b.join(" ")});this.append("nav",'<li alia-context class=":class"><a data-target=":target" data-toggle="tab" style="cursor:pointer;">:title</a></li>',{"class":b.join(" "),target:"#"+c.ids[""],title:alia.getString(a.title)})}return c}}()),alia.defineLayout({name:"heading"},function(){var a={1:"h1",2:"h2",3:"h3",4:"h4",5:"h5",6:"h6"};return function(b){alia.applyDefaults(b,{type:"h1",visible:!0});var c=this.append("<:type alia-context></:type>",{type:a[b.type]});return c.bindHtml("text",b.text),c.bindVisible(b.visible),c}}()),alia.defineControl({name:"heading"},function(){var a={1:"h1",2:"h2",3:"h3",4:"h4",5:"h5",6:"h6"};return function(b){alia.applyDefaults(b,{type:"h1",visible:!0});var c=this.append("<:type alia-context></:type>",{type:a[b.type]});return c.bindHtml("text",b.text),c.bindVisible(b.visible),c}}()),alia.defineControl({name:"link"},function(){return function(a){alia.applyDefaults(a,{visible:!0});var b=this.append('<a alia-context style="cursor: pointer"></a>');return"string"==typeof a.name&&b.attr("name",a.name),b.bindHtml("text",a.text),b.bindVisible(a.visible),b}}()),alia.defineControl({name:"text"},function(){var a={italics:"<em>:text</em>",bold:"<strong>:text</strong>"},b={small:"<small>:text</small>"},c={muted:"text-muted",primary:"text-primary",success:"text-success",info:"text-info",warning:"text-warning",danger:"text-danger"};return function(d){function e(c){g.empty(),void 0!==c&&("function"==typeof d.filter&&(c=d.filter(c)),"string"==typeof d.weight&&a.hasOwnProperty(d.weight)&&(c=a[d.weight].replace(":text",c)),"string"==typeof d.size&&b.hasOwnProperty(d.size)&&(c=b[d.size].replace(":text",c)),g.html(c))}alia.applyDefaults(d,{visible:!0});var f=[];"string"==typeof d.style&&c.hasOwnProperty(d.style)&&f.push(c[d.style]);var g=this.append('<span alia-context class=":class"></span>',{"class":f.join(" ")});return alia.isAccessor(d.text)?d.text.observe(function(a){e(a)},function(){e()}):e(d.text),g.bindVisible(d.visible),g}}()),alia.defineControl({name:"break"},function(){return this.append("<br />")}),alia.defineControl({name:"paragraph"},function(){var a={lead:"lead"},b={left:"text-left",center:"text-center",right:"text-right",justify:"text-justify"};return function(c){alia.applyDefaults(c,{visible:!0});var d=[];"string"==typeof c.style&&a.hasOwnProperty(c.style)&&d.push(a[c.style]),"string"==typeof c.alignment&&b.hasOwnProperty(c.alignment)&&d.push(b[c.alignment]);var e=this.append('<p alia-context class=":class">:text</p>',{"class":d.join(" "),text:alia.getString(c.text)});return e.bindHtml("text",c.text),e.bindVisible(c.visible),e}}()),alia.defineControl({name:"blockquote"},function(){var a={"default":null,reverse:"blockquote-reverse"};return function(b){alia.applyDefaults(b,{visible:!0,style:"default"},{style:a});var c='<blockquote alia-context class=":class">  <p alia-context="quote"></p></blockquote>',d=this.append(c,{"class":_.compact([a[b.style]]).join("")});if(b.footer){var e=d.append("<footer alia-context></footer>"),f=e.bindHtml("footer",b.footer);d.defineProperty("footer",f)}return d.bindHtml("quote","text",b.text),d}}()),alia.defineControl({name:"markdown"},function(){return function(a){alia.applyDefaults(a,{visible:!0});var b=Markdown.getSanitizingConverter();Markdown.Extra.init(b,{highlighter:"highlight",table_class:"table table-striped"});var c=this.append("<div alia-context></div>"),d=$("#"+c.id()),e=c.defineProperty("text",a.text);return e.onResolve(function(a){d.empty();var e=b.makeHtml(a);d.append(e),$("code").each(function(a,b){hljs.highlightBlock(b)}),MathJax.Hub.Queue(["Typeset",MathJax.Hub,c.id()])}),c.bindVisible(a.visible),c}}()),alia.defineControl({name:"horizontalRule"},function(){return this.append("<hr />")}),alia.defineControl({name:"widget"},function(){var a={inlineBlock:"inline-block"},b={right:"pull-right",left:"pull-left"};return function(c){function d(){for(var a=0;a<f.length;++a)if("undefined"==typeof f[a])return;e.empty();for(var b=[e],a=0;a<f.length;++a)b.push(f[a]);c.fcn.apply(null,b)}alia.applyDefaults(c,{visible:!0});var e=this.append("<div alia-context></div>");"string"==typeof c.display&&a.hasOwnProperty(c.display)&&e.css("display",a[c.display]),"number"==typeof c.margin&&e.css("margin",c.margin+"px"),"string"==typeof c.float&&b.hasOwnProperty(c.float)&&e.class("add",b[c.float]);for(var f=[],g=function(a,b){f[a]=b},h=0;h<c.args.length;++h)alia.isAccessor(c.args[h])?(f.push(void 0),c.args[h].onResolve(function(a){return function(b){g(a,b),d()}}(h))):f.push(c.args[h]);return d(),e.bindVisible(c.visible),e}}()),alia.defineProvider({name:"$"},function(){return $}),alia.defineProvider({name:"$window"},function(){return window}),alia.defineProvider({name:"$log",dependencies:["$window"]},function(a){return{}}),alia.defineProvider({name:"$location",dependencies:["$"]},function(a){function b(){return x.absUrl}function c(){var a=f();if(x.absUrl!==a){var b={redirect:null},b=alia.broadcast("locationChangeStarted",[x.absUrl,a]);b.isDefaultPrevented()?j(a):(f(x.absUrl),alia.broadcast("locationChanged",x.absUrl))}}function d(){var a=y.attr("href");return a?a.replace(/^(https?\:)?\/\/[^\/]*/,""):""}function e(a,b){return 0===b.indexOf(a)?b.substr(a.length):void 0}function f(a,b){return location!==window.location&&(location=window.location),history!==window.history&&(history=window.history),"string"!=typeof a?A||location.href.replace(/%27/g,"'"):void(z!==a&&(z=a,b?history.replaceState(null,"",a):history.pushState(null,"",a)))}function g(){var a=alia.url.toQueryString(x.search),b=x.hash?"#"+alia.url.encodeUriSegment(x.hash):"";x.url=alia.url.encodePath(x.path)+(a?"?"+a:"")+b,x.absUrl=D+x.url.substr(1)}function h(a){return"string"!=typeof a?x.hash:void g()}function i(){return x.host}function j(a){var b=e(D,a);if("string"!=typeof b)throw new Error("Invalid path url during location.parse");l(b),x.path||(x.path="/"),g()}function k(a){var b=alia.url.resolve(a,C);x.protocol=b.protocol,x.host=b.hostname,x.port=parseInt(b.port,10)||w[b.protocol]||null}function l(a){var b="/"!==a.charAt(0);b&&(a="/"+a);var c=alia.url.resolve(a,C),d=c.pathname,e=b&&"/"===d.charAt(0)?d.substring(1):d;x.path=decodeURIComponent(e),x.search=alia.url.parseQuery(c.search),x.hash=decodeURIComponent(c.hash),x.path&&"/"!=x.path.charAt(0)&&(x.path="/"+x.path)}function m(a){return"string"!=typeof a?x.path:(x.path="/"==a.charAt(0)?a:"/"+a,g(),c(),void 0)}function n(){return x.protocol}function o(){return x.port}function p(a){var b,c;return void 0!==(b=e(C,a))?(c=b,void 0!==(b=e(E,b))?D+(e("/",b)||b):C+c):void 0!==(b=e(D,a))?D+b:D==a+"/"?D:void 0}function q(a,b){switch(arguments.length){case 0:return x.search;case 1:if(alia.isString(a))x.search=alia.url.parseQuery(a);else{if(!alia.isObject(a))throw new Error("The first argument of the `$location#search()` call must be a string or an object.");x.search=a}break;default:alia.isUndefined(b)||null===b?delete x.search[a]:x.search[a]=b}g(),c()}function r(a){return a.substring(0,a.indexOf("/",a.indexOf("//")+2))}function s(a){return a.substr(0,t(a).lastIndexOf("/")+1)}function t(a){var b=a.indexOf("#");return-1==b?a:a.substr(0,b)}function u(a,b){if(alia.isUndefined(a))return x.url;var d=v.exec(a);d[1]&&m(decodeURIComponent(d[1])),(d[2]||d[1])&&q(d[3]||""),h(d[5]||"",b),c()}var v=/^([^\?#]*)(\?([^#]*))?(#(.*))?$/,w={http:80,https:443,ftp:21},x={absUrl:null,protocol:null,host:null,port:null,url:null},y=a("base"),z=location.href,A=null,B=f(),C=r(B)+(d()||"/"),D=s(C),E=E||"",F=a("body");return F.on("click",function(b){if(!b.ctrlKey&&!b.metaKey&&2!=b.which){for(var d=a(b.target);"a"!==d[0].nodeName.toLowerCase();)if(d[0]===F[0]||!(d=d.parent())[0])return;var e=d.prop("href"),g=p(e);e&&!d.attr("target")&&g&&!b.isDefaultPrevented()&&g!==f()&&(b.preventDefault(),j(g),c())}}),a(window).on("popstate",function(){console.log("popstate");var a=f();if(z!==a&&(z=a,x.absUrl!==a)){var b=x.absUrl;j(a),alia.broadcast("locationChanged",[x.absUrl,b])}}),k(C),j(p(B)),c(),{absUrl:b,baseHref:d,hash:h,host:i,path:m,protocol:n,port:o,search:q,url:u}}),alia.defineProvider({name:"$route",dependencies:["$","$location"]},function(a,b){function c(){if(h.hasOwnProperty(i.path)){var a=h[i.path];a.workspace?(i.context=alia.stageWorkspaceContext(),i.type="workspace"):a.multiview?(i.context=alia.stageMultiviewContext(),i.type="multiview"):(i.context=alia.stageViewContext(),i.type="view"),alia.resolve(a.dependencies,[i.context],{$params:i.params,$query:i.query}).onResolve(function(b){if(a.ctor.apply(null,b),"workspace"===i.type&&"string"==typeof i.query.task){var c=i.context,d=c.signature(i.query.task,i.query);c.currentSignature()!==d&&c.push(i.query.task,i.query)}else if("multiview"===i.type&&"string"==typeof i.query.view){var e=i.context,d=e.signature(i.query.view,i.query);e.currentSignature()!==d&&e.push(i.query.view,i.query)}})}}function d(a,b){if(!b.regex)return null;var c=b.regex.re.exec(a);if(!c)return null;for(var d=b.regex.keys,e={},f=1,g=c.length;g>f;++f){var h=d[f-1],i="string"==typeof c[f]?decodeURIComponent(c[f]):c[f];h&&i&&(e[h.name]=i)}return e}function e(){var a,c;for(var e in h){var a=d(b.path(),h[e]);if(a){c={path:e,params:a,query:b.search()};break}}return c}function f(a,b){b=b||{};var c=b.caseInsensitiveMatch,d={originalPath:a,re:a},e=d.keys=[];return a=a.replace(/([().])/g,"\\$1").replace(/(\/)?:(\w+)([\?\*])?/g,function(a,b,c,d){var f="?"===d?d:null,g="*"===d?d:null;return e.push({name:c,optional:!!f}),b=b||"",""+(f?"":b)+"(?:"+(f?b:"")+(g&&"(.+?)"||"([^/]+)")+(f||"")+")"+(f||"")}).replace(/([\/$\*])/g,"\\$1"),d.re=new RegExp("^"+a+"$",c?"i":""),d}function g(){var a=e();if(i&&i.path===a.path){if("workspace"===i.type&&"string"==typeof a.query.task){var b=i.context,d=b.signature(a.query.task,a.query);b.currentSignature()!==d&&b.push(a.query.task,a.query)}else if("multiview"===i.type&&"string"==typeof a.query.view){var f=i.context,d=f.signature(a.query.view,a.query);f.currentSignature()!==d&&f.push(a.query.view,a.query)}}else i=a,c()}var h={},i=null;alia.on("locationChanged",g);var j={};return j.when=function(a,c){h[a.path]={path:a.path,dependencies:a.dependencies,regex:f(a.path),workspace:a.workspace===!0,multiview:a.multiview===!0,ctor:c};var e=d(b.path(),h[a.path]);return e&&g(null,a.path),this},j.otherwise=function(){return this},j}),alia.defineProvider({name:"$request",dependencies:["$"]},function(a){function b(a,b,c){for(var d in b)a=a.replace(":"+d,b[d]);var e=[];if(Array.isArray(c))for(var f=0;f<c.length;++f)c[f].hasOwnProperty("key")&&c[f].hasOwnProperty("value")&&e.push(c[f].key+"="+c[f].value);else for(var d in c)c.hasOwnProperty(d)&&e.push(d+"="+c[d].toString());return e.length>0&&(a+="?"+e.join("&")),a}var c=function(c){var d={url:b(c.url,c.params,c.query),type:c.method?c.method:"GET"};c.json&&(d.data=JSON.stringify(c.json),d.contentType="application/json",d.processData=!1),a.extend(!0,c,d);var e=a.ajax(c);return alia.deferred(function(a,b){e.then(function(b,c,d){a({body:b,status:c,statusCode:d.status,xhr:d})},function(a,c,d){var e={error:d,status:c,statusCode:a.status,xhr:a},f=alia.broadcast("requestError",[e]);f.defaultPrevented,b(new Bacon.Error(e))})})};return c.get=function(a,b,d){return c({url:a,method:"GET",params:b,query:d})},c.post=function(a,b,d,e){switch(arguments.length){case 2:e=b,b=null;break;case 3:e=d,d=null;break;case 4:}return c({url:a,method:"POST",params:b,query:d,json:e})},c.put=function(a,b,d,e){switch(arguments.length){case 2:e=b,b=null;break;case 3:e=d,d=null;break;case 4:}return c({url:a,method:"PUT",params:b,query:d,json:e})},c});